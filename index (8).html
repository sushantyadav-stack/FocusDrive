<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FocusDrive</title>
<meta name="theme-color" content="#2c3e50">
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; transition: background 0.3s, color 0.3s; }
  body.light { background: #f0f0f0; color: #333; }
  body.dark { background: #1e1e1e; color: #eee; }
  header { background: #2c3e50; color: white; text-align: center; padding: 20px; }
  main { padding: 20px; max-width: 600px; margin: auto; }
  .task { display: flex; justify-content: space-between; margin: 10px 0; padding: 10px; border-radius: 5px; }
  .task.completed { text-decoration: line-through; opacity: 0.6; }
  .task button { background: #2c3e50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
  .task button:hover { background: #34495e; }
  input[type="text"] { width: 65%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; }
  button { margin: 5px; }
  #timer { font-size: 2em; text-align: center; margin: 20px 0; }
  #controls { text-align: center; margin: 10px 0; }
  #modeToggle { position: fixed; top: 10px; right: 10px; padding: 5px 10px; }
</style>
</head>
<body class="light">
<header><h1>FocusDrive</h1></header>
<button id="modeToggle">Toggle Dark/Light</button>
<main>
<div>
  <input type="text" id="newTask" placeholder="Add new task...">
  <button onclick="addTask()">Add</button>
</div>
<div id="tasks"></div>
<div id="timer">25:00</div>
<div id="controls">
  <button onclick="startFocus()">Start Focus</button>
  <button onclick="resetTimer()">Reset</button>
  <button onclick="startBreak(5)">Short Break</button>
  <button onclick="startBreak(15)">Long Break</button>
</div>
<div style="text-align:center; margin-top:15px;">
  <label>Focus Time: <input type="number" id="focusTime" value="25" min="1"> min</label>
  <button onclick="updateFocusTime()">Set</button>
</div>

<script>
// --- Dark/Light Mode ---
const modeBtn = document.getElementById('modeToggle');
modeBtn.onclick = ()=>{document.body.classList.toggle('dark');document.body.classList.toggle('light');}

// --- Task Management ---
const tasksDiv = document.getElementById('tasks');
let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
function renderTasks(){
  tasksDiv.innerHTML='';
  tasks.forEach((t,i)=>{
    const div = document.createElement('div');
    div.className='task'+(t.completed?' completed':'');
    div.innerHTML=`<span onclick="toggleTask(${i})">${t.text}</span>
                   <button onclick="removeTask(${i})">Done</button>`;
    tasksDiv.appendChild(div);
  });
  localStorage.setItem('tasks', JSON.stringify(tasks));
}
function addTask(){
  const input=document.getElementById('newTask');
  if(input.value.trim()!==''){
    tasks.push({text: input.value.trim(), completed:false});
    input.value='';
    renderTasks();
  }
}
function removeTask(i){tasks.splice(i,1);renderTasks();}
function toggleTask(i){tasks[i].completed=!tasks[i].completed;renderTasks();}
renderTasks();

// --- Timer ---
let timerDuration=25*60; 
let timerInterval=null;
const timerDisplay=document.getElementById('timer');
function updateTimerDisplay(){
  let m=Math.floor(timerDuration/60); let s=timerDuration%60;
  timerDisplay.textContent=`${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}
function startFocus(){
  if(timerInterval) return;
  timerInterval=setInterval(()=>{
    if(timerDuration>0){timerDuration--; updateTimerDisplay();}
    else{clearInterval(timerInterval); timerInterval=null; alert("Focus session complete!"); notifyUser(); resetTimer();}
  },1000);
}
function resetTimer(){clearInterval(timerInterval);timerInterval=null;timerDuration=document.getElementById('focusTime').value*60;updateTimerDisplay();}
function startBreak(mins){clearInterval(timerInterval);timerInterval=null;timerDuration=mins*60;updateTimerDisplay();startFocus();}

// --- Adjustable Focus Time ---
function updateFocusTime(){timerDuration=document.getElementById('focusTime').value*60; updateTimerDisplay();}

// --- Notifications ---
function notifyUser(){
  if(Notification.permission==='granted'){new Notification("FocusDrive","Session complete! Take a break.");}
  else if(Notification.permission!=='denied'){
    Notification.requestPermission().then(p=>{if(p==='granted') new Notification("FocusDrive","Session complete! Take a break.");});
  }
}

// --- Service Worker (Offline) ---
if('serviceWorker' in navigator){
  navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
    const cacheName='focusdrive-v2';
    const filesToCache=['/'];
    self.addEventListener('install',e=>{e.waitUntil(caches.open(cacheName).then(c=>c.addAll(filesToCache)))});
    self.addEventListener('activate',e=>{e.waitUntil(clients.claim())});
    self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))});
  `], {type:'text/javascript'})));
}
</script>

<script type="application/manifest+json">
{
  "name": "FocusDrive",
  "short_name": "FocusDrive",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#f0f0f0",
  "theme_color": "#2c3e50",
  "icons":[
    {"src":"icon-192.png","sizes":"192x192","type":"image/png"},
    {"src":"icon-512.png","sizes":"512x512","type":"image/png"}
  ]
}
</script>
</body>
</html>