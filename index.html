<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Focus Arena ‚Äì Ultimate Productivity</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="manifest" href="/manifest.json">
<style>
/* ===== CSS RESET & VARIABLES ===== */
:root {
  --primary: #00D4FF;
  --primary-dark: #0099CC;
  --secondary: #9D4EDD;
  --accent: #FF6B6B;
  --success: #4CAF50;
  --warning: #FF9800;
  --dark: #121212;
  --darker: #0A0A0A;
  --light: #F8F9FA;
  --gray: #2D2D2D;
  --gray-light: #3D3D3D;
  --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  --radius: 16px;
  --radius-sm: 8px;
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  -webkit-tap-highlight-color: transparent;
}

body {
  background: linear-gradient(135deg, var(--darker) 0%, #1A1A2E 100%);
  color: var(--light);
  min-height: 100vh;
}

/* ===== PROFILE SETUP ===== */
.profile-setup-container {
  display: flex;
  min-height: 100vh;
  justify-content: center;
  align-items: center;
  padding: 1rem;
}

.profile-box {
  background: rgba(18, 18, 18, 0.95);
  backdrop-filter: blur(10px);
  border-radius: var(--radius);
  padding: 2.5rem;
  width: 100%;
  max-width: 500px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: var(--shadow);
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.profile-header {
  text-align: center;
  margin-bottom: 2rem;
}

.profile-logo {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.profile-logo i {
  color: var(--primary);
  font-size: 2.5rem;
  filter: drop-shadow(0 0 8px rgba(0, 212, 255, 0.5));
}

.profile-logo h1 {
  font-size: 2rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
}

.profile-subtitle {
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 2rem;
  font-size: 1.1rem;
}

.avatar-selection {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.avatar-option {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  cursor: pointer;
  transition: var(--transition);
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid transparent;
}

.avatar-option:hover {
  transform: scale(1.1);
  border-color: var(--primary);
}

.avatar-option.selected {
  border-color: var(--primary);
  background: rgba(0, 212, 255, 0.2);
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
}

/* ===== MAIN APP ===== */
.app-container {
  display: none;
  min-height: 100vh;
}

.app-container.active {
  display: block;
}

/* ===== SMOOTH NAVIGATION ===== */
.section-enter {
  transform: translateX(20px);
  opacity: 0;
}

.section-active {
  transform: translateX(0);
  opacity: 1;
}

.section-exit {
  transform: translateX(-20px);
  opacity: 0;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
}

/* ===== BEAUTIFUL LABELS ===== */
.label-container {
  display: inline-block;
  margin: 0.5rem;
  position: relative;
}

.label {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  border-radius: 50px;
  font-weight: 600;
  font-size: 0.9rem;
  position: relative;
  overflow: hidden;
  transition: var(--transition);
  cursor: default;
  backdrop-filter: blur(10px);
  border: 2px solid transparent;
}

.label::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: currentColor;
  opacity: 0.1;
  z-index: -1;
}

.label i {
  font-size: 1rem;
}

/* Label Variants */
.label-primary {
  color: var(--primary);
  border-color: var(--primary);
  background: linear-gradient(135deg, rgba(0, 212, 255, 0.15), transparent);
}

.label-secondary {
  color: var(--secondary);
  border-color: var(--secondary);
  background: linear-gradient(135deg, rgba(157, 78, 221, 0.15), transparent);
}

.label-accent {
  color: var(--accent);
  border-color: var(--accent);
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.15), transparent);
}

.label-success {
  color: var(--success);
  border-color: var(--success);
  background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), transparent);
}

.label-warning {
  color: var(--warning);
  border-color: var(--warning);
  background: linear-gradient(135deg, rgba(255, 152, 0, 0.15), transparent);
}

.label:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
}

/* Badge Labels */
.label-badge {
  position: absolute;
  top: -8px;
  right: -8px;
  background: var(--accent);
  color: white;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.7rem;
  font-weight: 800;
  z-index: 1;
}

/* ===== HEADER ===== */
header {
  background: rgba(18, 18, 18, 0.95);
  backdrop-filter: blur(10px);
  padding: 1.2rem 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: var(--shadow);
  position: sticky;
  top: 0;
  z-index: 100;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  transition: var(--transition);
}

.logo {
  display: flex;
  align-items: center;
  gap: 0.8rem;
  cursor: pointer;
}

.logo-icon {
  color: var(--primary);
  font-size: 1.8rem;
  filter: drop-shadow(0 0 8px rgba(0, 212, 255, 0.5));
  transition: var(--transition);
}

.logo:hover .logo-icon {
  transform: rotate(15deg) scale(1.1);
}

.logo h1 {
  font-size: 1.5rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
  transition: var(--transition);
}

.logo:hover h1 {
  transform: translateX(5px);
}

.user-stats {
  display: flex;
  gap: 0.8rem;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}

/* ===== NAVIGATION ===== */
.nav-container {
  background: rgba(18, 18, 18, 0.9);
  backdrop-filter: blur(10px);
  padding: 0.8rem 1rem;
  position: sticky;
  top: 72px;
  z-index: 99;
  overflow-x: auto;
  scrollbar-width: none;
  border-bottom: 1px solid rgba(255, 255, 255, 0.05);
  transition: var(--transition);
}

.nav-container::-webkit-scrollbar {
  display: none;
}

nav {
  display: flex;
  justify-content: space-around;
  gap: 0.5rem;
  min-width: max-content;
}

.nav-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.7);
  padding: 0.8rem 1rem;
  border-radius: var(--radius-sm);
  font-weight: 600;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: var(--transition);
  white-space: nowrap;
  flex: 1;
  justify-content: center;
  max-width: 120px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.nav-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: 0.6s;
}

.nav-btn:hover::before {
  left: 100%;
}

.nav-btn:hover, .nav-btn.active {
  background: var(--primary);
  color: var(--dark);
  transform: translateY(-3px);
  box-shadow: 0 6px 25px rgba(0, 212, 255, 0.4);
  border-color: var(--primary);
}

.nav-btn i {
  font-size: 1.1rem;
  transition: var(--transition);
}

.nav-btn.active i {
  transform: scale(1.2);
}

.nav-btn-indicator {
  position: absolute;
  bottom: -5px;
  left: 50%;
  transform: translateX(-50%);
  width: 5px;
  height: 5px;
  background: var(--primary);
  border-radius: 50%;
  opacity: 0;
  transition: var(--transition);
}

.nav-btn.active .nav-btn-indicator {
  opacity: 1;
  transform: translateX(-50%) scale(1.5);
}

/* ===== SECTIONS ===== */
.sections-container {
  position: relative;
  min-height: calc(100vh - 140px);
  overflow: hidden;
}

section {
  display: none;
  padding: 1.5rem 1rem;
  max-width: 1200px;
  margin: 0 auto;
  opacity: 0;
  transform: translateX(20px);
  transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
}

section.active {
  display: block;
  opacity: 1;
  transform: translateX(0);
  position: relative;
  animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.section-header {
  text-align: center;
  margin-bottom: 2rem;
  animation: fadeInUp 0.6s ease 0.2s both;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.section-title {
  font-size: 2.2rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 0.5rem;
  font-weight: 800;
}

.section-subtitle {
  color: rgba(255, 255, 255, 0.7);
  font-size: 1.1rem;
}

/* ===== ORB CONTAINER ===== */
.orb-section {
  text-align: center;
  padding: 2rem 0;
  animation: fadeInUp 0.6s ease 0.3s both;
}

.orb-container {
  position: relative;
  width: 280px;
  height: 280px;
  margin: 0 auto 2rem;
  cursor: pointer;
  transition: transform 0.3s ease;
}

.orb-container:hover {
  transform: scale(1.05);
}

.orb {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, 
    rgba(0, 212, 255, 0.9) 0%, 
    rgba(157, 78, 221, 0.7) 50%, 
    transparent 70%);
  box-shadow: 
    inset 0 0 50px rgba(255, 255, 255, 0.1),
    0 0 80px rgba(0, 212, 255, 0.6),
    0 0 120px rgba(157, 78, 221, 0.4);
  position: relative;
  overflow: hidden;
  animation: orbPulse 4s infinite alternate ease-in-out;
}

@keyframes orbPulse {
  0% { 
    transform: scale(1);
    box-shadow: 
      inset 0 0 50px rgba(255, 255, 255, 0.1),
      0 0 80px rgba(0, 212, 255, 0.6),
      0 0 120px rgba(157, 78, 221, 0.4);
  }
  50% {
    transform: scale(1.02);
    box-shadow: 
      inset 0 0 60px rgba(255, 255, 255, 0.15),
      0 0 100px rgba(0, 212, 255, 0.7),
      0 0 150px rgba(157, 78, 221, 0.5);
  }
  100% { 
    transform: scale(1);
    box-shadow: 
      inset 0 0 50px rgba(255, 255, 255, 0.1),
      0 0 80px rgba(0, 212, 255, 0.6),
      0 0 120px rgba(157, 78, 221, 0.4);
  }
}

.orb::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: radial-gradient(circle at 70% 20%, 
    rgba(255, 255, 255, 0.2) 0%, 
    transparent 30%);
  border-radius: 50%;
  animation: orbShine 6s infinite linear;
}

@keyframes orbShine {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.orb-particles {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
}

.orb-particle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: var(--primary);
  border-radius: 50%;
  filter: blur(1px);
  animation: particleFloat 4s infinite linear;
}

@keyframes particleFloat {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translate(var(--tx), var(--ty)) scale(0);
    opacity: 0;
  }
}

.time-display {
  font-size: 4.5rem;
  font-weight: 800;
  text-align: center;
  margin: 1.5rem 0;
  font-variant-numeric: tabular-nums;
  text-shadow: 0 0 30px rgba(0, 212, 255, 0.7);
  background: linear-gradient(90deg, var(--primary), var(--secondary), #FF6B6B);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: timeGlow 3s infinite alternate;
}

@keyframes timeGlow {
  0% { text-shadow: 0 0 30px rgba(0, 212, 255, 0.7); }
  100% { text-shadow: 0 0 40px rgba(157, 78, 221, 0.8); }
}

/* ===== CONTROL BUTTONS ===== */
.control-buttons {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin: 2rem 0;
  flex-wrap: wrap;
  animation: fadeInUp 0.6s ease 0.4s both;
}

.control-btn {
  padding: 1rem 2rem;
  border: none;
  border-radius: var(--radius);
  font-weight: 700;
  font-size: 1.1rem;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  transition: var(--transition);
  cursor: pointer;
  min-width: 180px;
  position: relative;
  overflow: hidden;
}

.control-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: 0.5s;
}

.control-btn:hover::before {
  left: 100%;
}

.control-btn:active {
  transform: scale(0.95);
}

.btn-start {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  box-shadow: 0 6px 25px rgba(0, 212, 255, 0.4);
}

.btn-pause {
  background: linear-gradient(135deg, #FFB347, #FF8C00);
  color: white;
  box-shadow: 0 6px 25px rgba(255, 140, 0, 0.4);
}

.btn-reset {
  background: linear-gradient(135deg, #FF6B6B, #FF4757);
  color: white;
  box-shadow: 0 6px 25px rgba(255, 107, 107, 0.4);
}

.btn-stopwatch {
  background: linear-gradient(135deg, #9D4EDD, #7B2CBF);
  color: white;
  box-shadow: 0 6px 25px rgba(157, 78, 221, 0.4);
}

/* ===== TIMER & STOPWATCH ===== */
.timer-container {
  text-align: center;
  margin: 2rem 0;
}

.mode-switcher {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin-bottom: 2rem;
  animation: fadeInUp 0.6s ease 0.3s both;
}

.mode-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.7);
  padding: 0.8rem 1.5rem;
  border-radius: var(--radius-sm);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.mode-btn.active {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
}

.timer-display {
  font-size: 5rem;
  font-weight: 800;
  margin: 2rem 0;
  font-variant-numeric: tabular-nums;
  text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.timer-inputs {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin: 2rem 0;
  flex-wrap: wrap;
  animation: fadeInUp 0.6s ease 0.4s both;
}

.time-input {
  background: rgba(255, 255, 255, 0.08);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--radius);
  padding: 1rem;
  font-size: 1.5rem;
  color: white;
  text-align: center;
  width: 120px;
  transition: var(--transition);
}

.time-input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
  outline: none;
  transform: translateY(-2px);
}

.preset-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.8rem;
  justify-content: center;
  margin: 2rem 0;
  animation: fadeInUp 0.6s ease 0.5s both;
}

.preset-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: white;
  padding: 0.8rem 1.5rem;
  border-radius: var(--radius);
  font-weight: 600;
  transition: var(--transition);
  cursor: pointer;
}

.preset-btn:hover {
  background: var(--primary);
  color: var(--dark);
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
}

/* ===== NEW FEATURES ===== */

/* 1. Calendar Feature */
.calendar-container {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-top: 2rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.calendar-grid {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 0.5rem;
}

.calendar-day {
  text-align: center;
  padding: 0.5rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.7);
}

.calendar-date {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: var(--transition);
  position: relative;
}

.calendar-date:hover {
  background: rgba(255, 255, 255, 0.1);
}

.calendar-date.active {
  background: var(--primary);
  color: white;
  transform: scale(1.1);
}

.calendar-date.has-session::after {
  content: '';
  position: absolute;
  bottom: 5px;
  width: 4px;
  height: 4px;
  background: var(--success);
  border-radius: 50%;
}

/* 2. To-Do List */
.todo-container {
  margin-top: 2rem;
}

.todo-input-container {
  display: flex;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.todo-input {
  flex: 1;
  padding: 0.8rem 1rem;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--radius-sm);
  color: white;
  font-size: 1rem;
}

.todo-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.todo-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius-sm);
  transition: var(--transition);
}

.todo-item:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateX(5px);
}

.todo-item.completed .todo-text {
  text-decoration: line-through;
  color: rgba(255, 255, 255, 0.5);
}

.todo-checkbox {
  width: 20px;
  height: 20px;
  border-radius: 4px;
  border: 2px solid var(--primary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.todo-checkbox.checked {
  background: var(--primary);
}

.todo-checkbox.checked::after {
  content: '‚úì';
  color: white;
  font-size: 12px;
}

.todo-text {
  flex: 1;
}

.todo-priority {
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-size: 0.8rem;
  font-weight: 600;
}

.priority-high { background: rgba(255, 107, 107, 0.2); color: #FF6B6B; }
.priority-medium { background: rgba(255, 193, 7, 0.2); color: #FFC107; }
.priority-low { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }

/* 3. Notes Feature */
.notes-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
}

.note-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: var(--transition);
  cursor: pointer;
}

.note-card:hover {
  transform: translateY(-5px);
  border-color: var(--primary);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
}

.note-title {
  font-size: 1.2rem;
  margin-bottom: 0.5rem;
  font-weight: 600;
}

.note-content {
  color: rgba(255, 255, 255, 0.7);
  font-size: 0.9rem;
  line-height: 1.5;
}

.note-date {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.5);
  margin-top: 1rem;
}

/* 4. Goals Tracker */
.goals-container {
  margin-top: 2rem;
}

.goal-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-bottom: 1rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.goal-progress {
  margin-top: 1rem;
}

/* 5. Music Player */
.music-player {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-top: 2rem;
}

.music-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 2rem;
  margin-top: 1rem;
}

.music-btn {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: var(--primary);
  border: none;
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  transition: var(--transition);
}

.music-btn:hover {
  transform: scale(1.1);
}

/* 6. Pomodoro Timer */
.pomodoro-container {
  text-align: center;
  margin-top: 2rem;
}

.pomodoro-display {
  font-size: 3rem;
  font-weight: 800;
  margin: 1rem 0;
}

/* 7. Water Tracker */
.water-tracker {
  background: rgba(33, 150, 243, 0.1);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-top: 2rem;
}

.water-glasses {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 0.5rem;
  margin-top: 1rem;
}

.water-glass {
  width: 40px;
  height: 60px;
  background: rgba(33, 150, 243, 0.2);
  border-radius: 4px;
  cursor: pointer;
  transition: var(--transition);
}

.water-glass.filled {
  background: #2196F3;
}

/* 8. Mood Tracker */
.mood-tracker {
  display: flex;
  justify-content: space-between;
  margin-top: 2rem;
}

.mood-option {
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  padding: 1rem;
  border-radius: var(--radius-sm);
}

.mood-option:hover {
  background: rgba(255, 255, 255, 0.05);
  transform: scale(1.1);
}

.mood-option.selected {
  background: rgba(0, 212, 255, 0.1);
}

.mood-emoji {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

/* 9. Quick Notes */
.quick-notes {
  margin-top: 2rem;
}

.quick-note-input {
  width: 100%;
  min-height: 100px;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: var(--radius-sm);
  color: white;
  font-size: 1rem;
  resize: vertical;
}

/* 10. Focus Music */
.focus-music-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.music-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius-sm);
  padding: 1rem;
  cursor: pointer;
  transition: var(--transition);
  text-align: center;
}

.music-track:hover {
  background: rgba(0, 212, 255, 0.1);
  transform: translateY(-2px);
}

.music-track.playing {
  background: rgba(0, 212, 255, 0.2);
  border-color: var(--primary);
}

/* ===== MARKETPLACE ===== */
.marketplace-section {
  padding: 2rem 0;
}

.market-filters {
  display: flex;
  justify-content: center;
  gap: 1rem;
  margin: 2rem 0;
  flex-wrap: wrap;
  animation: fadeInUp 0.6s ease 0.3s both;
}

.filter-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.7);
  padding: 0.6rem 1.2rem;
  border-radius: 50px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.filter-btn.active {
  background: var(--primary);
  color: var(--dark);
  border-color: var(--primary);
  transform: translateY(-2px);
}

.marketplace-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.market-item {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  cursor: pointer;
  animation: fadeInUp 0.6s ease;
  animation-fill-mode: both;
}

.market-item:nth-child(1) { animation-delay: 0.1s; }
.market-item:nth-child(2) { animation-delay: 0.2s; }
.market-item:nth-child(3) { animation-delay: 0.3s; }
.market-item:nth-child(4) { animation-delay: 0.4s; }
.market-item:nth-child(5) { animation-delay: 0.5s; }
.market-item:nth-child(6) { animation-delay: 0.6s; }

.market-item:hover {
  transform: translateY(-8px);
  border-color: var(--primary);
  box-shadow: 0 15px 40px rgba(0, 212, 255, 0.2);
}

.market-item.owned {
  background: linear-gradient(135deg, rgba(157, 78, 221, 0.2), rgba(0, 212, 255, 0.1));
  border-color: var(--secondary);
}

.item-badge {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: var(--accent);
  color: white;
  padding: 0.3rem 0.8rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 700;
  z-index: 1;
}

.item-icon {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  display: block;
  text-align: center;
  transition: var(--transition);
}

.market-item:hover .item-icon {
  transform: scale(1.2) rotate(5deg);
}

.item-name {
  font-size: 1.3rem;
  margin-bottom: 0.5rem;
  font-weight: 700;
  text-align: center;
}

.item-desc {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 1.2rem;
  line-height: 1.5;
  text-align: center;
}

.item-price {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1rem;
}

.price-tag {
  font-weight: 700;
  color: var(--primary);
  font-size: 1.2rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.buy-btn {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border: none;
  color: white;
  padding: 0.7rem 1.5rem;
  border-radius: var(--radius-sm);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.buy-btn:active {
  transform: scale(0.95);
}

.buy-btn.owned {
  background: linear-gradient(135deg, #4CAF50, #2E7D32);
}

.buy-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.item-stats {
  display: flex;
  justify-content: space-between;
  margin-top: 1rem;
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.5);
}

.rarity {
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-weight: 600;
  font-size: 0.7rem;
}

.rarity.common { background: rgba(255, 255, 255, 0.1); color: #aaa; }
.rarity.uncommon { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
.rarity.rare { background: rgba(33, 150, 243, 0.2); color: #2196F3; }
.rarity.epic { background: rgba(157, 78, 221, 0.2); color: #9D4EDD; }
.rarity.legendary { background: rgba(255, 193, 7, 0.2); color: #FFC107; }
.rarity.mythic { background: rgba(255, 87, 34, 0.2); color: #FF5722; }

/* ===== STATISTICS SECTION ===== */
.stats-section {
  padding: 2rem 0;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
}

.stat-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  text-align: center;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
  animation: fadeInUp 0.6s ease;
  animation-fill-mode: both;
}

.stat-card:nth-child(1) { animation-delay: 0.1s; }
.stat-card:nth-child(2) { animation-delay: 0.2s; }
.stat-card:nth-child(3) { animation-delay: 0.3s; }
.stat-card:nth-child(4) { animation-delay: 0.4s; }
.stat-card:nth-child(5) { animation-delay: 0.5s; }
.stat-card:nth-child(6) { animation-delay: 0.6s; }

.stat-card:hover {
  transform: translateY(-5px);
  border-color: var(--primary);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.02), transparent);
  z-index: 0;
}

.stat-icon {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  display: block;
  color: var(--primary);
  position: relative;
  z-index: 1;
}

.stat-value {
  font-size: 2.5rem;
  font-weight: 800;
  margin-bottom: 0.5rem;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  position: relative;
  z-index: 1;
}

.stat-label {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
  position: relative;
  z-index: 1;
}

.stat-progress {
  margin-top: 1rem;
  position: relative;
  z-index: 1;
}

.progress-bar {
  height: 6px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--secondary));
  border-radius: 3px;
  transition: width 1s ease;
}

/* Stats Charts */
.stats-charts {
  margin-top: 3rem;
  animation: fadeInUp 0.6s ease 0.7s both;
}

.chart-container {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-top: 1rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: var(--transition);
}

.chart-container:hover {
  border-color: var(--primary);
  transform: translateY(-2px);
}

.chart-title {
  font-size: 1.2rem;
  margin-bottom: 1rem;
  color: rgba(255, 255, 255, 0.9);
}

.chart {
  height: 200px;
  display: flex;
  align-items: flex-end;
  gap: 4px;
  padding: 1rem 0;
}

.chart-bar {
  flex: 1;
  background: linear-gradient(to top, var(--primary), var(--secondary));
  border-radius: 4px 4px 0 0;
  min-height: 1px;
  transition: height 1s ease;
  position: relative;
  cursor: pointer;
}

.chart-bar:hover {
  opacity: 0.8;
}

.chart-bar:hover::after {
  content: attr(data-value);
  position: absolute;
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--dark);
  color: white;
  padding: 0.3rem 0.6rem;
  border-radius: 4px;
  font-size: 0.8rem;
  white-space: nowrap;
  z-index: 10;
}

/* ===== ACHIEVEMENTS SECTION ===== */
.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
}

.achievement-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.achievement-card.locked {
  opacity: 0.7;
  filter: grayscale(0.5);
}

.achievement-card.unlocked {
  border-color: var(--success);
}

.achievement-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
}

.achievement-icon {
  font-size: 2.5rem;
  margin-bottom: 1rem;
  text-align: center;
  color: var(--primary);
}

.achievement-progress {
  margin-top: 1rem;
}

.progress-text {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

/* ===== SETTINGS SECTION ===== */
.settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 2rem;
}

.setting-card {
  background: rgba(255, 255, 255, 0.05);
  border-radius: var(--radius);
  padding: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.setting-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

/* Switch */
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(255, 255, 255, 0.1);
  transition: var(--transition);
  border-radius: 34px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: var(--transition);
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--primary);
}

input:checked + .slider:before {
  transform: translateX(26px);
}

/* ===== MODALS ===== */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: rgba(18, 18, 18, 0.95);
  border-radius: var(--radius);
  padding: 2rem;
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: var(--shadow);
}

/* ===== NOTIFICATION ===== */
.notification {
  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  padding: 1rem 1.5rem;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  z-index: 1000;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  opacity: 0;
  transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.5s;
}

.notification.show {
  transform: translateX(-50%) translateY(0);
  opacity: 1;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
  .timer-display {
    font-size: 3.5rem;
  }
  
  .time-display {
    font-size: 3.5rem;
  }
  
  .control-btn {
    min-width: 140px;
    padding: 0.8rem 1.5rem;
  }
  
  .marketplace-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  }
  
  .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }
  
  .orb-container {
    width: 220px;
    height: 220px;
  }
  
  .avatar-selection {
    grid-template-columns: repeat(4, 1fr);
  }
  
  .calendar-grid {
    gap: 0.2rem;
  }
}

@media (max-width: 480px) {
  .nav-btn {
    padding: 0.6rem 0.5rem;
    font-size: 0.8rem;
    max-width: 90px;
  }
  
  .nav-btn i {
    font-size: 0.9rem;
  }
  
  .logo h1 {
    font-size: 1.2rem;
  }
  
  .user-stats {
    gap: 0.5rem;
  }
  
  .timer-display {
    font-size: 2.5rem;
  }
  
  .time-display {
    font-size: 3rem;
  }
  
  .time-input {
    width: 80px;
    font-size: 1.2rem;
    padding: 0.8rem;
  }
  
  .section-title {
    font-size: 1.8rem;
  }
  
  .avatar-selection {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Theme Colors */
.theme-dark {
  --primary: #00D4FF;
  --primary-dark: #0099CC;
  --secondary: #9D4EDD;
  --accent: #FF6B6B;
  --success: #4CAF50;
  --warning: #FF9800;
  --dark: #121212;
  --darker: #0A0A0A;
  --light: #F8F9FA;
}

.theme-light {
  --primary: #2563EB;
  --primary-dark: #1D4ED8;
  --secondary: #7C3AED;
  --accent: #EF4444;
  --success: #10B981;
  --warning: #F59E0B;
  --dark: #F8FAFC;
  --darker: #F1F5F9;
  --light: #1E293B;
  --gray: #E2E8F0;
  --gray-light: #CBD5E1;
}

.theme-ocean {
  --primary: #06B6D4;
  --primary-dark: #0891B2;
  --secondary: #0EA5E9;
  --accent: #F97316;
  --success: #10B981;
  --warning: #F59E0B;
  --dark: #0F172A;
  --darker: #1E293B;
  --light: #F8FAFC;
}

.theme-forest {
  --primary: #10B981;
  --primary-dark: #059669;
  --secondary: #84CC16;
  --accent: #F97316;
  --success: #22C55E;
  --warning: #EAB308;
  --dark: #064E3B;
  --darker: #065F46;
  --light: #F8FAFC;
}

.theme-sunset {
  --primary: #F97316;
  --primary-dark: #EA580C;
  --secondary: #EAB308;
  --accent: #EF4444;
  --success: #84CC16;
  --warning: #F59E0B;
  --dark: #1E293B;
  --darker: #0F172A;
  --light: #F8FAFC;
}
</style>
</head>
<body>

<!-- ===== PROFILE SETUP ===== -->
<div id="profileSetup" class="profile-setup-container">
  <div class="profile-box">
    <div class="profile-header">
      <div class="profile-logo">
        <i class="fas fa-bullseye"></i>
        <h1>FOCUS ARENA</h1>
      </div>
      <h2>Welcome! Create Your Profile üéÆ</h2>
      <p class="profile-subtitle">Personalize your productivity journey</p>
    </div>
    
    <form id="profileForm">
      <div class="form-group">
        <label for="username"><i class="fas fa-user"></i> Your Name</label>
        <input type="text" id="username" placeholder="Enter your name" required>
      </div>
      
      <div class="form-group">
        <label><i class="fas fa-smile"></i> Choose Avatar</label>
        <div class="avatar-selection" id="avatarSelection">
          <!-- Avatars will be generated -->
        </div>
      </div>
      
      <div class="form-group">
        <label for="focusGoal"><i class="fas fa-bullseye"></i> Daily Focus Goal (minutes)</label>
        <input type="number" id="focusGoal" min="15" max="480" value="120" required>
      </div>
      
      <div class="form-group">
        <label for="productivityTheme"><i class="fas fa-palette"></i> Productivity Theme</label>
        <select id="productivityTheme" class="time-input">
          <option value="deep_work">Deep Work</option>
          <option value="creative_flow">Creative Flow</option>
          <option value="study_sessions">Study Sessions</option>
          <option value="work_sprints">Work Sprints</option>
        </select>
      </div>
      
      <button type="submit" class="auth-btn">
        <i class="fas fa-rocket"></i> Start Productivity Journey
      </button>
    </form>
  </div>
</div>

<!-- ===== MAIN APP ===== -->
<div id="appContainer" class="app-container">
  <!-- Header -->
  <header>
    <div class="logo" onclick="showSection('play')">
      <div class="logo-icon"><i class="fas fa-bullseye"></i></div>
      <h1>FOCUS ARENA</h1>
    </div>
    <div class="user-stats">
      <div class="label-container">
        <span class="label label-primary" onclick="showSection('marketplace')">
          <i class="fas fa-coins"></i> <span id="coins">0</span> Coins
        </span>
      </div>
      <div class="label-container">
        <span class="label label-secondary" onclick="showSection('stats')">
          <i class="fas fa-trophy"></i> Lvl <span id="lvl">1</span>
          <span class="label-badge" id="xpBadge">0%</span>
        </span>
      </div>
      <div class="label-container">
        <span class="label label-accent" onclick="showProfileModal()">
          <i class="fas fa-user"></i> <span id="headerUsername">User</span>
        </span>
      </div>
      <button class="logout-btn" onclick="exportAllData()">
        <i class="fas fa-download"></i> Export
      </button>
    </div>
  </header>

  <!-- Navigation -->
  <div class="nav-container">
    <nav>
      <button class="nav-btn active" data-section="play" onclick="showSection('play')">
        <i class="fas fa-play-circle"></i> Focus
        <div class="nav-btn-indicator"></div>
      </button>
      <button class="nav-btn" data-section="calendar" onclick="showSection('calendar')">
        <i class="fas fa-calendar"></i> Calendar
        <div class="nav-btn-indicator"></div>
      </button>
      <button class="nav-btn" data-section="todo" onclick="showSection('todo')">
        <i class="fas fa-tasks"></i> To-Do
        <div class="nav-btn-indicator"></div>
      </button>
      <button class="nav-btn" data-section="notes" onclick="showSection('notes')">
        <i class="fas fa-sticky-note"></i> Notes
        <div class="nav-btn-indicator"></div>
      </button>
      <button class="nav-btn" data-section="marketplace" onclick="showSection('marketplace')">
        <i class="fas fa-store"></i> Market
        <div class="nav-btn-indicator"></div>
      </button>
      <button class="nav-btn" data-section="stats" onclick="showSection('stats')">
        <i class="fas fa-chart-bar"></i> Stats
        <div class="nav-btn-indicator"></div>
      </button>
      <button class="nav-btn" data-section="achievements" onclick="showSection('achievements')">
        <i class="fas fa-medal"></i> Achievements
        <div class="nav-btn-indicator"></div>
      </button>
      <button class="nav-btn" data-section="settings" onclick="showSection('settings')">
        <i class="fas fa-cog"></i> Settings
        <div class="nav-btn-indicator"></div>
      </button>
    </nav>
  </div>

  <!-- Sections Container -->
  <div class="sections-container">
    <!-- Main Play Section -->
    <section id="play" class="active">
      <div class="section-header">
        <h2 class="section-title">Focus Mode üéØ</h2>
        <p class="section-subtitle">Maximize your productivity with focused sessions</p>
      </div>
      
      <div class="mode-switcher">
        <button class="mode-btn active" onclick="switchMode('timer')">
          <i class="fas fa-hourglass-half"></i> Timer
        </button>
        <button class="mode-btn" onclick="switchMode('stopwatch')">
          <i class="fas fa-stopwatch"></i> Stopwatch
        </button>
        <button class="mode-btn" onclick="switchMode('pomodoro')">
          <i class="fas fa-redo"></i> Pomodoro
        </button>
        <button class="mode-btn" onclick="switchMode('habit')">
          <i class="fas fa-check-circle"></i> Habits
        </button>
      </div>
      
      <!-- Timer Mode -->
      <div id="timerMode" class="timer-container">
        <!-- Orb Container -->
        <div class="orb-section">
          <div class="orb-container" onclick="toggleOrbPulse()">
            <div class="orb" id="focusOrb"></div>
          </div>
          <div class="time-display" id="timerDisplay">25:00</div>
        </div>
        
        <div class="timer-inputs">
          <input type="number" class="time-input" id="hours" placeholder="HH" min="0" max="23" value="0">
          <div style="font-size: 2rem; color: var(--primary);">:</div>
          <input type="number" class="time-input" id="minutes" placeholder="MM" min="0" max="59" value="25">
          <div style="font-size: 2rem; color: var(--primary);">:</div>
          <input type="number" class="time-input" id="seconds" placeholder="SS" min="0" max="59" value="0">
        </div>
        
        <div class="preset-buttons">
          <button class="preset-btn" onclick="setTimer(5)">5 min</button>
          <button class="preset-btn" onclick="setTimer(15)">15 min</button>
          <button class="preset-btn" onclick="setTimer(25)">25 min</button>
          <button class="preset-btn" onclick="setTimer(45)">45 min</button>
          <button class="preset-btn" onclick="setTimer(60)">60 min</button>
        </div>
      </div>
      
      <!-- Stopwatch Mode -->
      <div id="stopwatchMode" class="timer-container" style="display: none;">
        <!-- Orb Container -->
        <div class="orb-section">
          <div class="orb-container" onclick="toggleOrbPulse()">
            <div class="orb" id="stopwatchOrb"></div>
          </div>
          <div class="time-display" id="stopwatchDisplay">00:00:00</div>
        </div>
        
        <div class="label-container">
          <span class="label label-success" id="lapCount">
            <i class="fas fa-flag"></i> Laps: 0
          </span>
        </div>
        
        <div id="lapTimes" style="margin: 2rem 0; max-height: 200px; overflow-y: auto;"></div>
      </div>
      
      <!-- Pomodoro Mode -->
      <div id="pomodoroMode" class="timer-container" style="display: none;">
        <div class="orb-section">
          <div class="orb-container">
            <div class="orb"></div>
          </div>
          <div class="pomodoro-display" id="pomodoroDisplay">25:00</div>
        </div>
        
        <div class="label-container">
          <span class="label label-warning" id="pomodoroPhase">
            <i class="fas fa-clock"></i> Focus Time
          </span>
        </div>
        
        <div class="pomodoro-settings">
          <div style="display: flex; gap: 1rem; justify-content: center; margin: 1rem 0;">
            <div>
              <label style="display: block; margin-bottom: 0.5rem;">Focus (min)</label>
              <input type="number" id="focusTime" value="25" min="5" max="60" class="time-input" style="width: 80px;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem;">Break (min)</label>
              <input type="number" id="breakTime" value="5" min="1" max="30" class="time-input" style="width: 80px;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.5rem;">Sessions</label>
              <input type="number" id="pomodoroSessions" value="4" min="1" max="12" class="time-input" style="width: 80px;">
            </div>
          </div>
        </div>
      </div>
      
      <!-- Habit Mode -->
      <div id="habitMode" class="timer-container" style="display: none;">
        <div class="section-header">
          <h3 class="section-title">Daily Habits üìù</h3>
          <p class="section-subtitle">Build consistent productivity habits</p>
        </div>
        
        <div id="habitsList" style="margin: 2rem 0;">
          <!-- Habits will be dynamically generated -->
        </div>
        
        <div class="control-buttons">
          <button class="control-btn btn-start" onclick="addNewHabit()">
            <i class="fas fa-plus"></i> Add New Habit
          </button>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div class="control-buttons">
        <button class="control-btn btn-start" onclick="startTimer()" id="startBtn">
          <i class="fas fa-play"></i> START
        </button>
        <button class="control-btn btn-pause" onclick="pauseTimer()" id="pauseBtn" disabled>
          <i class="fas fa-pause"></i> PAUSE
        </button>
        <button class="control-btn btn-reset" onclick="resetTimer()" id="resetBtn">
          <i class="fas fa-redo"></i> RESET
        </button>
        <button class="control-btn btn-stopwatch" onclick="recordLap()" id="lapBtn" style="display: none;">
          <i class="fas fa-flag"></i> LAP
        </button>
      </div>
      
      <!-- Focus Music -->
      <div class="focus-music">
        <h3 style="text-align: center; margin: 2rem 0 1rem;">Focus Music üéµ</h3>
        <div class="focus-music-grid" id="focusMusicGrid">
          <!-- Music tracks will be dynamically generated -->
        </div>
      </div>
    </section>

    <!-- Calendar Section -->
    <section id="calendar">
      <div class="section-header">
        <h2 class="section-title">Productivity Calendar üìÖ</h2>
        <p class="section-subtitle">Plan and track your productive days</p>
      </div>
      
      <div class="calendar-container">
        <div class="calendar-header">
          <button class="control-btn btn-reset" onclick="prevMonth()">
            <i class="fas fa-chevron-left"></i>
          </button>
          <h3 id="currentMonth">January 2024</h3>
          <button class="control-btn btn-start" onclick="nextMonth()">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        
        <div class="calendar-grid" id="calendarDays">
          <!-- Calendar will be dynamically generated -->
        </div>
      </div>
      
      <!-- Day Details -->
      <div id="dayDetails" style="margin-top: 2rem; display: none;">
        <h3 id="selectedDate">Selected Date</h3>
        <div id="dayStats"></div>
      </div>
    </section>

    <!-- To-Do List Section -->
    <section id="todo">
      <div class="section-header">
        <h2 class="section-title">To-Do List ‚úÖ</h2>
        <p class="section-subtitle">Organize your tasks and get things done</p>
      </div>
      
      <div class="todo-container">
        <div class="todo-input-container">
          <input type="text" class="todo-input" id="newTodo" placeholder="Add a new task...">
          <select id="todoPriority" class="time-input" style="width: 120px;">
            <option value="low">Low Priority</option>
            <option value="medium">Medium Priority</option>
            <option value="high">High Priority</option>
          </select>
          <button class="control-btn btn-start" onclick="addTodo()">
            <i class="fas fa-plus"></i> Add
          </button>
        </div>
        
        <div class="todo-list" id="todoList">
          <!-- To-do items will be dynamically generated -->
        </div>
      </div>
      
      <!-- Task Statistics -->
      <div class="stats-grid" style="margin-top: 2rem;">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-tasks"></i></div>
          <div class="stat-value" id="totalTasks">0</div>
          <div class="stat-label">Total Tasks</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
          <div class="stat-value" id="completedTasks">0</div>
          <div class="stat-label">Completed</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-fire"></i></div>
          <div class="stat-value" id="productivityScore">0%</div>
          <div class="stat-label">Productivity</div>
        </div>
      </div>
    </section>

    <!-- Notes Section -->
    <section id="notes">
      <div class="section-header">
        <h2 class="section-title">Quick Notes üìù</h2>
        <p class="section-subtitle">Capture ideas, thoughts, and important information</p>
      </div>
      
      <div class="quick-notes">
        <textarea class="quick-note-input" id="quickNote" placeholder="Start typing your note here..."></textarea>
        <div class="control-buttons" style="margin-top: 1rem;">
          <button class="control-btn btn-start" onclick="saveQuickNote()">
            <i class="fas fa-save"></i> Save Note
          </button>
          <button class="control-btn btn-reset" onclick="clearQuickNote()">
            <i class="fas fa-trash"></i> Clear
          </button>
        </div>
      </div>
      
      <div class="notes-container" id="notesContainer">
        <!-- Notes will be dynamically generated -->
      </div>
    </section>

    <!-- Marketplace Section -->
    <section id="marketplace">
      <div class="section-header">
        <h2 class="section-title">Marketplace üõçÔ∏è</h2>
        <p class="section-subtitle">Enhance your productivity experience</p>
      </div>
      
      <div class="market-filters">
        <button class="filter-btn active" onclick="filterMarket('all')">All</button>
        <button class="filter-btn" onclick="filterMarket('themes')">Themes</button>
        <button class="filter-btn" onclick="filterMarket('effects')">Effects</button>
        <button class="filter-btn" onclick="filterMarket('sounds')">Sounds</button>
        <button class="filter-btn" onclick="filterMarket('tools')">Tools</button>
        <button class="filter-btn" onclick="filterMarket('premium')">Premium</button>
      </div>
      
      <div class="marketplace-grid" id="marketplaceGrid">
        <!-- Items will be dynamically generated -->
      </div>
    </section>

    <!-- Statistics Section -->
    <section id="stats">
      <div class="section-header">
        <h2 class="section-title">Your Statistics üìä</h2>
        <p class="section-subtitle">Track your productivity journey in detail</p>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-coins"></i></div>
          <div class="stat-value" id="totalCoins">0</div>
          <div class="stat-label">Total Coins</div>
          <div class="stat-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="coinsProgress" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-fire"></i></div>
          <div class="stat-value" id="currentStreak">0</div>
          <div class="stat-label">Current Streak</div>
          <div class="stat-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="streakProgress" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-clock"></i></div>
          <div class="stat-value" id="totalFocusTime">0h</div>
          <div class="stat-label">Focus Time</div>
          <div class="stat-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="timeProgress" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
          <div class="stat-value" id="activeDays">0</div>
          <div class="stat-label">Active Days</div>
          <div class="stat-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="daysProgress" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-tasks"></i></div>
          <div class="stat-value" id="completedSessions">0</div>
          <div class="stat-label">Sessions</div>
          <div class="stat-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="sessionsProgress" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-star"></i></div>
          <div class="stat-value" id="achievementsCount">0</div>
          <div class="stat-label">Achievements</div>
          <div class="stat-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="achievementsProgress" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="stats-charts">
        <h3 class="chart-title">Weekly Focus Trend</h3>
        <div class="chart-container">
          <div class="chart" id="weeklyChart">
            <!-- Chart will be generated from real data -->
          </div>
        </div>
      </div>
      
      <!-- Water Tracker -->
      <div class="water-tracker">
        <h3>üíß Water Tracker</h3>
        <p>Stay hydrated for better focus</p>
        <div class="water-glasses" id="waterGlasses">
          <!-- Water glasses will be dynamically generated -->
        </div>
        <button class="control-btn btn-start" onclick="resetWaterTracker()" style="margin-top: 1rem;">
          <i class="fas fa-redo"></i> Reset
        </button>
      </div>
      
      <!-- Mood Tracker -->
      <div class="mood-tracker">
        <div class="mood-option" onclick="setMood('happy')">
          <div class="mood-emoji">üòä</div>
          <div>Happy</div>
        </div>
        <div class="mood-option" onclick="setMood('productive')">
          <div class="mood-emoji">üöÄ</div>
          <div>Productive</div>
        </div>
        <div class="mood-option" onclick="setMood('tired')">
          <div class="mood-emoji">üò¥</div>
          <div>Tired</div>
        </div>
        <div class="mood-option" onclick="setMood('focused')">
          <div class="mood-emoji">üéØ</div>
          <div>Focused</div>
        </div>
      </div>
    </section>

    <!-- Achievements Section -->
    <section id="achievements">
      <div class="section-header">
        <h2 class="section-title">Achievements üèÜ</h2>
        <p class="section-subtitle">Unlock rewards for your productivity</p>
      </div>
      
      <div class="achievements-grid" id="achievementsGrid">
        <!-- Achievements will be dynamically generated -->
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings">
      <div class="section-header">
        <h2 class="section-title">Settings ‚öôÔ∏è</h2>
        <p class="section-subtitle">Customize your experience</p>
      </div>
      
      <div class="settings-grid">
        <div class="setting-card">
          <h3 style="margin-bottom: 1.5rem; color: var(--primary);">App Settings</h3>
          
          <div class="setting-option">
            <span>Sound Effects</span>
            <label class="switch">
              <input type="checkbox" id="soundEffects" checked>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="setting-option">
            <span>Notifications</span>
            <label class="switch">
              <input type="checkbox" id="notifications" checked>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="setting-option">
            <span>Focus Reminders</span>
            <label class="switch">
              <input type="checkbox" id="focusReminders" checked>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="setting-option">
            <span>Auto-save Notes</span>
            <label class="switch">
              <input type="checkbox" id="autoSave" checked>
              <span class="slider"></span>
            </label>
          </div>
        </div>
        
        <div class="setting-card">
          <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Timer Settings</h3>
          
          <div class="setting-option">
            <span>Default Timer (min)</span>
            <input type="number" id="defaultTimer" value="25" min="5" max="120" style="width: 80px; padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 4px;">
          </div>
          
          <div class="setting-option">
            <span>Auto-start Breaks</span>
            <label class="switch">
              <input type="checkbox" id="autoBreak" checked>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="setting-option">
            <span>End Session Sound</span>
            <select id="endSound" style="width: 120px; padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); color: white; border-radius: 4px;">
              <option value="bell">Bell</option>
              <option value="chime">Chime</option>
              <option value="beep">Beep</option>
            </select>
          </div>
        </div>
        
        <div class="setting-card">
          <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Data Management</h3>
          
          <button class="control-btn btn-start" onclick="exportAllData()" style="width: 100%; margin-bottom: 1rem;">
            <i class="fas fa-download"></i> Export All Data
          </button>
          
          <button class="control-btn btn-pause" onclick="importData()" style="width: 100%; margin-bottom: 1rem;">
            <i class="fas fa-upload"></i> Import Data
          </button>
          
          <button class="control-btn btn-reset" onclick="resetAppData()" style="width: 100%;">
            <i class="fas fa-trash"></i> Reset All Data
          </button>
        </div>
      </div>
      
      <!-- Theme Selector -->
      <div class="setting-card" style="margin-top: 2rem;">
        <h3 style="margin-bottom: 1.5rem; color: var(--primary);">Theme Selection</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
          <div class="theme-option" onclick="changeTheme('dark')" style="padding: 1rem; background: #121212; border-radius: var(--radius-sm); cursor: pointer; text-align: center;">
            <div style="color: #00D4FF; font-size: 1.2rem; margin-bottom: 0.5rem;">üåô</div>
            <div>Dark Theme</div>
          </div>
          <div class="theme-option" onclick="changeTheme('light')" style="padding: 1rem; background: #F8FAFC; border-radius: var(--radius-sm); cursor: pointer; text-align: center; color: #1E293B;">
            <div style="color: #2563EB; font-size: 1.2rem; margin-bottom: 0.5rem;">‚òÄÔ∏è</div>
            <div>Light Theme</div>
          </div>
          <div class="theme-option" onclick="changeTheme('ocean')" style="padding: 1rem; background: #0F172A; border-radius: var(--radius-sm); cursor: pointer; text-align: center;">
            <div style="color: #06B6D4; font-size: 1.2rem; margin-bottom: 0.5rem;">üåä</div>
            <div>Ocean Theme</div>
          </div>
          <div class="theme-option" onclick="changeTheme('forest')" style="padding: 1rem; background: #064E3B; border-radius: var(--radius-sm); cursor: pointer; text-align: center;">
            <div style="color: #10B981; font-size: 1.2rem; margin-bottom: 0.5rem;">üå≥</div>
            <div>Forest Theme</div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Profile Modal -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <h2 style="margin-bottom: 1.5rem; color: var(--primary);">Profile Settings</h2>
      
      <div style="text-align: center; margin-bottom: 2rem;">
        <div class="avatar-option selected" style="width: 100px; height: 100px; margin: 0 auto 1rem; font-size: 3rem;" id="modalAvatar">
          üë®‚Äçüíª
        </div>
        <h3 id="modalUsername">Username</h3>
        <p style="color: rgba(255,255,255,0.7);" id="modalLevel">Level 1 ‚Ä¢ 0 XP</p>
      </div>
      
      <div class="form-group">
        <label for="editUsername">Change Name</label>
        <input type="text" id="editUsername" placeholder="Enter new name">
      </div>
      
      <div class="form-group">
        <label for="editAvatar">Change Avatar</label>
        <div class="avatar-selection" id="modalAvatarSelection">
          <!-- Avatars will be generated -->
        </div>
      </div>
      
      <div style="display: flex; gap: 1rem; margin-top: 2rem;">
        <button class="control-btn btn-start" onclick="updateProfile()" style="flex: 1;">
          <i class="fas fa-save"></i> Save Changes
        </button>
        <button class="control-btn btn-reset" onclick="closeModal('profileModal')" style="flex: 1;">
          <i class="fas fa-times"></i> Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <i class="fas fa-bell"></i>
    <span id="notificationText">Ready to focus!</span>
  </div>
</div>

<script>
// ===== GLOBAL STATE =====
let currentUser = null;
let timerInterval = null;
let stopwatchInterval = null;
let pomodoroInterval = null;
let timerMode = 'timer';
let stopwatchTime = 0;
let stopwatchRunning = false;
let lapTimes = [];
let currentTimer = {
  hours: 0,
  minutes: 25,
  seconds: 0,
  running: false,
  totalSeconds: 25 * 60
};
let pomodoroState = {
  isRunning: false,
  isBreak: false,
  focusTime: 25 * 60,
  breakTime: 5 * 60,
  sessions: 0,
  totalSessions: 4,
  currentTime: 25 * 60
};
let orbPulse = true;
let currentDate = new Date();
let selectedMood = null;

// ===== AVATARS =====
const avatars = [
  'üë®‚Äçüíª', 'üë©‚Äçüíª', 'üßë‚Äçüéì', 'üë®‚Äçüéì', 'üë©‚Äçüéì', 'üßô‚Äç‚ôÇÔ∏è', 'üßô‚Äç‚ôÄÔ∏è', 'ü¶∏‚Äç‚ôÇÔ∏è', 'ü¶∏‚Äç‚ôÄÔ∏è', 'üßö‚Äç‚ôÇÔ∏è', 'üßö‚Äç‚ôÄÔ∏è',
  'üßú‚Äç‚ôÇÔ∏è', 'üßú‚Äç‚ôÄÔ∏è', 'üê±', 'üê∂', 'ü¶ä', 'üêº', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏',
  'üêµ', 'üêî', 'üêß', 'üê¶', 'ü¶â', 'ü¶Ñ', 'üêô', 'ü¶ã', 'üêù', 'üê¢', 'ü¶ñ',
  'ü¶ï', 'üêâ', 'ü¶ö', 'ü¶ú', 'üê¨', 'ü¶à', 'üêã', 'üêò', 'ü¶í', 'ü¶ò', 'ü¶è',
  'ü¶õ', 'üê™', 'üê´', 'ü¶ô', 'ü¶å', 'üêê', 'üêè', 'üêë', 'üêé', 'ü¶Ñ', 'ü¶ì'
];

// ===== OFFLINE DATABASE =====
class OfflineDatabase {
  constructor() {
    this.loadData();
  }
  
  loadData() {
    // Load user data
    this.user = JSON.parse(localStorage.getItem('focusArenaUser')) || null;
    this.sessions = JSON.parse(localStorage.getItem('focusArenaSessions')) || [];
    this.habits = JSON.parse(localStorage.getItem('focusArenaHabits')) || [];
    this.todos = JSON.parse(localStorage.getItem('focusArenaTodos')) || [];
    this.notes = JSON.parse(localStorage.getItem('focusArenaNotes')) || [];
    this.achievements = JSON.parse(localStorage.getItem('focusArenaAchievements')) || this.generateAchievements();
    this.settings = JSON.parse(localStorage.getItem('focusArenaSettings')) || this.defaultSettings();
    this.calendarData = JSON.parse(localStorage.getItem('focusArenaCalendar')) || {};
    this.marketItems = this.generateMarketItems();
    
    // Initialize if no user exists
    if (!this.user) {
      this.initializeDemoData();
    }
  }
  
  initializeDemoData() {
    this.user = {
      id: 'user_' + Date.now(),
      username: 'Productivity Master',
      avatar: 'üë®‚Äçüíª',
      level: 1,
      coins: 100,
      xp: 0,
      totalFocusTime: 0,
      streak: 0,
      dailyGoal: 120,
      theme: 'deep_work',
      achievements: [1],
      ownedItems: [1],
      createdAt: new Date().toISOString(),
      lastLogin: new Date().toISOString(),
      dailyStreakDate: null
    };
    
    this.saveData();
  }
  
  defaultSettings() {
    return {
      soundEffects: true,
      notifications: true,
      focusReminders: true,
      autoSave: true,
      defaultTimer: 25,
      autoBreak: true,
      endSound: 'bell',
      theme: 'dark'
    };
  }
  
  generateMarketItems() {
    return [
      // Themes
      { id: 1, name: "Dark Theme", description: "Default dark theme", icon: "fas fa-moon", price: 0, type: "theme", category: "themes", rarity: "common", data: { theme: "dark" } },
      { id: 2, name: "Light Theme", description: "Clean light theme", icon: "fas fa-sun", price: 100, type: "theme", category: "themes", rarity: "common", data: { theme: "light" } },
      { id: 3, name: "Ocean Theme", description: "Calm ocean colors", icon: "fas fa-water", price: 200, type: "theme", category: "themes", rarity: "uncommon", data: { theme: "ocean" } },
      { id: 4, name: "Forest Theme", description: "Nature inspired theme", icon: "fas fa-tree", price: 200, type: "theme", category: "themes", rarity: "uncommon", data: { theme: "forest" } },
      { id: 5, name: "Sunset Theme", description: "Warm sunset colors", icon: "fas fa-sunset", price: 300, type: "theme", category: "themes", rarity: "rare", data: { theme: "sunset" } },
      { id: 6, name: "Neon Theme", description: "Vibrant neon colors", icon: "fas fa-lightbulb", price: 500, type: "theme", category: "themes", rarity: "epic", data: { theme: "neon" } },
      
      // Effects
      { id: 7, name: "Particle Effects", description: "Beautiful particle animations", icon: "fas fa-sparkles", price: 150, type: "effect", category: "effects", rarity: "uncommon" },
      { id: 8, name: "Confetti Burst", description: "Celebrate achievements with confetti", icon: "fas fa-birthday-cake", price: 100, type: "effect", category: "effects", rarity: "common" },
      { id: 9, name: "Orb Glow", description: "Enhanced orb glow effects", icon: "fas fa-circle", price: 200, type: "effect", category: "effects", rarity: "rare" },
      
      // Sounds
      { id: 10, name: "Rain Sounds", description: "Calming rain sounds", icon: "fas fa-cloud-rain", price: 100, type: "sound", category: "sounds", rarity: "common" },
      { id: 11, name: "Forest Sounds", description: "Nature ambience", icon: "fas fa-tree", price: 150, type: "sound", category: "sounds", rarity: "uncommon" },
      { id: 12, name: "White Noise", description: "Focus-enhancing white noise", icon: "fas fa-volume-up", price: 100, type: "sound", category: "sounds", rarity: "common" },
      
      // Tools
      { id: 13, name: "Advanced Stats", description: "Detailed productivity analytics", icon: "fas fa-chart-line", price: 300, type: "tool", category: "tools", rarity: "rare" },
      { id: 14, name: "Habit Templates", description: "Pre-made habit templates", icon: "fas fa-clipboard-list", price: 200, type: "tool", category: "tools", rarity: "uncommon" },
      { id: 15, name: "Focus Music Pack", description: "Curated focus music collection", icon: "fas fa-music", price: 250, type: "tool", category: "tools", rarity: "rare" },
      
      // Premium
      { id: 16, name: "Unlimited Themes", description: "Access all themes", icon: "fas fa-palette", price: 1000, type: "premium", category: "premium", rarity: "legendary" },
      { id: 17, name: "All Effects Pack", description: "All visual effects", icon: "fas fa-magic", price: 800, type: "premium", category: "premium", rarity: "epic" },
      { id: 18, name: "Pro Features", description: "All premium features", icon: "fas fa-crown", price: 2000, type: "premium", category: "premium", rarity: "mythic" }
    ];
  }
  
  generateAchievements() {
    return [
      { id: 1, name: "First Focus", description: "Complete your first focus session", icon: "fas fa-baby", points: 10, requirement: { type: "sessions", value: 1 } },
      { id: 2, name: "Focus Novice", description: "Complete 10 focus sessions", icon: "fas fa-graduation-cap", points: 50, requirement: { type: "sessions", value: 10 } },
      { id: 3, name: "Time Master", description: "Accumulate 10 hours of focus", icon: "fas fa-clock", points: 100, requirement: { type: "time", value: 36000 } },
      { id: 4, name: "Week Warrior", description: "7-day focus streak", icon: "fas fa-fire", points: 75, requirement: { type: "streak", value: 7 } },
      { id: 5, name: "Task Master", description: "Complete 50 tasks", icon: "fas fa-tasks", points: 80, requirement: { type: "tasks", value: 50 } },
      { id: 6, name: "Note Taker", description: "Create 20 notes", icon: "fas fa-sticky-note", points: 40, requirement: { type: "notes", value: 20 } },
      { id: 7, name: "Habit Builder", description: "Maintain a habit for 30 days", icon: "fas fa-check-circle", points: 120, requirement: { type: "habit", value: 30 } },
      { id: 8, name: "Market Expert", description: "Purchase 10 items", icon: "fas fa-store", points: 60, requirement: { type: "purchases", value: 10 } },
      { id: 9, name: "Early Bird", description: "Focus before 8 AM", icon: "fas fa-sun", points: 30, requirement: { type: "early", value: 1 } },
      { id: 10, name: "Night Owl", description: "Focus after 10 PM", icon: "fas fa-moon", points: 30, requirement: { type: "late", value: 1 } }
    ];
  }
  
  saveData() {
    localStorage.setItem('focusArenaUser', JSON.stringify(this.user));
    localStorage.setItem('focusArenaSessions', JSON.stringify(this.sessions));
    localStorage.setItem('focusArenaHabits', JSON.stringify(this.habits));
    localStorage.setItem('focusArenaTodos', JSON.stringify(this.todos));
    localStorage.setItem('focusArenaNotes', JSON.stringify(this.notes));
    localStorage.setItem('focusArenaAchievements', JSON.stringify(this.achievements));
    localStorage.setItem('focusArenaSettings', JSON.stringify(this.settings));
    localStorage.setItem('focusArenaCalendar', JSON.stringify(this.calendarData));
  }
  
  // User methods
  createUser(username, avatar, goal, theme) {
    this.user = {
      id: 'user_' + Date.now(),
      username,
      avatar,
      level: 1,
      coins: 100,
      xp: 0,
      totalFocusTime: 0,
      streak: 0,
      dailyGoal: goal,
      theme,
      achievements: [1],
      ownedItems: [1],
      createdAt: new Date().toISOString(),
      lastLogin: new Date().toISOString(),
      dailyStreakDate: null
    };
    
    // Create default habits
    this.habits = [
      { id: 1, name: "Morning Focus", description: "Start day with focused work", streak: 0, completedToday: false, createdAt: new Date().toISOString() },
      { id: 2, name: "Daily Planning", description: "Plan your day ahead", streak: 0, completedToday: false, createdAt: new Date().toISOString() },
      { id: 3, name: "Evening Review", description: "Review accomplishments", streak: 0, completedToday: false, createdAt: new Date().toISOString() }
    ];
    
    this.saveData();
    return this.user;
  }
  
  updateUser(data) {
    this.user = { ...this.user, ...data };
    this.saveData();
    return this.user;
  }
  
  // Session methods
  addSession(duration, type = 'focus') {
    const session = {
      id: Date.now(),
      duration,
      type,
      timestamp: new Date().toISOString(),
      coinsEarned: Math.floor(duration / 60) * 5,
      xpEarned: Math.floor(duration / 60) * 10
    };
    
    this.sessions.push(session);
    
    // Update user stats
    this.user.totalFocusTime += duration;
    this.user.coins += session.coinsEarned;
    this.user.xp += session.xpEarned;
    
    // Check level up
    const xpNeeded = this.user.level * 100;
    if (this.user.xp >= xpNeeded) {
      this.user.level++;
      this.user.coins += 100;
      showNotification(`üéâ Level Up! You're now level ${this.user.level}!`);
    }
    
    // Update streak
    const today = new Date().toDateString();
    if (this.user.dailyStreakDate !== today) {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      
      if (this.user.dailyStreakDate === yesterday.toDateString()) {
        this.user.streak++;
      } else {
        this.user.streak = 1;
      }
      
      this.user.dailyStreakDate = today;
      this.user.coins += 50; // Daily bonus
    }
    
    // Update calendar data
    const dateKey = new Date().toISOString().split('T')[0];
    if (!this.calendarData[dateKey]) {
      this.calendarData[dateKey] = { sessions: 0, focusTime: 0 };
    }
    this.calendarData[dateKey].sessions++;
    this.calendarData[dateKey].focusTime += duration;
    
    // Check achievements
    this.checkAchievements();
    
    this.saveData();
    return session;
  }
  
  checkAchievements() {
    const unlocked = [];
    
    this.achievements.forEach(achievement => {
      if (this.user.achievements.includes(achievement.id)) return;
      
      let unlockedThis = false;
      
      switch(achievement.requirement.type) {
        case 'sessions':
          unlockedThis = this.sessions.length >= achievement.requirement.value;
          break;
        case 'time':
          unlockedThis = this.user.totalFocusTime >= achievement.requirement.value;
          break;
        case 'streak':
          unlockedThis = this.user.streak >= achievement.requirement.value;
          break;
        case 'tasks':
          unlockedThis = this.todos.filter(t => t.completed).length >= achievement.requirement.value;
          break;
        case 'notes':
          unlockedThis = this.notes.length >= achievement.requirement.value;
          break;
        case 'purchases':
          unlockedThis = this.user.ownedItems.length >= achievement.requirement.value;
          break;
      }
      
      if (unlockedThis) {
        this.user.achievements.push(achievement.id);
        this.user.coins += achievement.points * 10;
        unlocked.push(achievement);
        
        showNotification(`üèÜ Achievement Unlocked: ${achievement.name}! +${achievement.points * 10} coins`);
      }
    });
    
    return unlocked;
  }
  
  // Habit methods
  getHabits() {
    return this.habits;
  }
  
  updateHabit(id, completed) {
    const habit = this.habits.find(h => h.id === id);
    if (!habit) return null;
    
    const today = new Date().toDateString();
    
    if (completed && !habit.completedToday) {
      habit.completedToday = true;
      habit.lastCompleted = today;
      
      if (this.isYesterday(habit.lastCompleted)) {
        habit.streak++;
      } else {
        habit.streak = 1;
      }
      
      // Award coins for habit completion
      this.user.coins += 10;
    } else if (!completed) {
      habit.completedToday = false;
    }
    
    this.saveData();
    return habit;
  }
  
  addHabit(name, description) {
    const habit = {
      id: Date.now(),
      name,
      description,
      streak: 0,
      completedToday: false,
      createdAt: new Date().toISOString()
    };
    
    this.habits.push(habit);
    this.saveData();
    return habit;
  }
  
  isYesterday(dateString) {
    if (!dateString) return false;
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    return dateString === yesterday.toDateString();
  }
  
  // Todo methods
  getTodos() {
    return this.todos;
  }
  
  addTodo(text, priority = 'medium') {
    const todo = {
      id: Date.now(),
      text,
      priority,
      completed: false,
      createdAt: new Date().toISOString()
    };
    
    this.todos.push(todo);
    this.saveData();
    return todo;
  }
  
  toggleTodo(id) {
    const todo = this.todos.find(t => t.id === id);
    if (todo) {
      todo.completed = !todo.completed;
      this.saveData();
    }
    return todo;
  }
  
  // Note methods
  getNotes() {
    return this.notes;
  }
  
  addNote(title, content) {
    const note = {
      id: Date.now(),
      title: title || 'Untitled Note',
      content,
      createdAt: new Date().toISOString()
    };
    
    this.notes.push(note);
    this.saveData();
    return note;
  }
  
  // Marketplace methods
  purchaseItem(itemId) {
    const item = this.marketItems.find(i => i.id === itemId);
    if (!item) throw new Error('Item not found');
    
    if (this.user.coins < item.price) {
      throw new Error('Insufficient coins');
    }
    
    if (this.user.ownedItems.includes(itemId)) {
      throw new Error('Item already owned');
    }
    
    this.user.coins -= item.price;
    this.user.ownedItems.push(itemId);
    
    // Apply item effect
    if (item.type === 'theme') {
      this.settings.theme = item.data.theme;
      applyTheme(item.data.theme);
    }
    
    this.saveData();
    return { success: true, coins: this.user.coins };
  }
  
  // Settings methods
  updateSettings(newSettings) {
    this.settings = { ...this.settings, ...newSettings };
    this.saveData();
    return this.settings;
  }
  
  // Export/Import
  exportAllData() {
    return {
      user: this.user,
      sessions: this.sessions,
      habits: this.habits,
      todos: this.todos,
      notes: this.notes,
      achievements: this.achievements,
      settings: this.settings,
      calendarData: this.calendarData,
      exportDate: new Date().toISOString(),
      version: '1.0'
    };
  }
  
  importData(data) {
    if (!data.user) throw new Error('Invalid data format');
    
    this.user = data.user;
    this.sessions = data.sessions || [];
    this.habits = data.habits || [];
    this.todos = data.todos || [];
    this.notes = data.notes || [];
    this.achievements = data.achievements || this.generateAchievements();
    this.settings = data.settings || this.defaultSettings();
    this.calendarData = data.calendarData || {};
    
    this.saveData();
    return true;
  }
  
  resetData() {
    localStorage.clear();
    this.loadData();
  }
}

// ===== INITIALIZE DATABASE =====
const db = new OfflineDatabase();

// ===== PROFILE SETUP =====
function initProfileSetup() {
  const avatarSelection = document.getElementById('avatarSelection');
  avatarSelection.innerHTML = '';
  
  // Display first 24 avatars for selection
  avatars.slice(0, 24).forEach((avatar, index) => {
    const avatarOption = document.createElement('div');
    avatarOption.className = 'avatar-option';
    if (index === 0) avatarOption.classList.add('selected');
    avatarOption.textContent = avatar;
    avatarOption.onclick = () => {
      document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('selected'));
      avatarOption.classList.add('selected');
    };
    avatarSelection.appendChild(avatarOption);
  });
  
  // Handle profile form submission
  document.getElementById('profileForm').onsubmit = (e) => {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const avatar = document.querySelector('.avatar-option.selected').textContent;
    const focusGoal = parseInt(document.getElementById('focusGoal').value);
    const theme = document.getElementById('productivityTheme').value;
    
    if (!username.trim()) {
      showNotification('Please enter your name');
      return;
    }
    
    // Create user in database
    currentUser = db.createUser(username, avatar, focusGoal, theme);
    
    // Show main app
    document.getElementById('profileSetup').style.display = 'none';
    document.getElementById('appContainer').classList.add('active');
    
    // Initialize app
    initializeApp();
    
    showNotification(`Welcome to Focus Arena, ${username}! üöÄ`);
    triggerConfetti();
  };
}

// ===== APP INITIALIZATION =====
function initializeApp() {
  if (!currentUser) {
    currentUser = db.user;
  }
  
  // Update UI with user data
  updateUserStats();
  loadHabits();
  loadTodos();
  loadNotes();
  renderMarketplace();
  renderAchievements();
  updateCalendar();
  loadFocusMusic();
  loadSettings();
  
  // Create orb particles
  createOrbParticles();
  
  // Set default timer
  setTimer(db.settings.defaultTimer || 25);
}

// ===== TIMER FUNCTIONS =====
function switchMode(mode) {
  timerMode = mode;
  
  // Update UI
  document.querySelectorAll('.mode-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  // Show/hide mode containers
  document.getElementById('timerMode').style.display = mode === 'timer' ? 'block' : 'none';
  document.getElementById('stopwatchMode').style.display = mode === 'stopwatch' ? 'block' : 'none';
  document.getElementById('pomodoroMode').style.display = mode === 'pomodoro' ? 'block' : 'none';
  document.getElementById('habitMode').style.display = mode === 'habit' ? 'block' : 'none';
  
  // Update button visibility
  document.getElementById('lapBtn').style.display = mode === 'stopwatch' ? 'flex' : 'none';
  document.getElementById('startBtn').style.display = mode !== 'habit' ? 'flex' : 'none';
  document.getElementById('pauseBtn').style.display = mode !== 'habit' ? 'flex' : 'none';
  document.getElementById('resetBtn').style.display = mode !== 'habit' ? 'flex' : 'none';
  
  resetTimer();
}

function setTimer(minutes) {
  currentTimer.minutes = minutes;
  currentTimer.seconds = 0;
  currentTimer.hours = 0;
  currentTimer.totalSeconds = minutes * 60;
  
  // Update inputs
  document.getElementById('hours').value = 0;
  document.getElementById('minutes').value = minutes;
  document.getElementById('seconds').value = 0;
  
  updateTimerDisplay();
  showNotification(`Timer set to ${minutes} minutes ‚è∞`);
}

function startTimer() {
  if (timerMode === 'timer') {
    startFocusTimer();
  } else if (timerMode === 'stopwatch') {
    startStopwatch();
  } else if (timerMode === 'pomodoro') {
    startPomodoro();
  }
}

function pauseTimer() {
  if (timerMode === 'timer') {
    pauseFocusTimer();
  } else if (timerMode === 'stopwatch') {
    pauseStopwatch();
  } else if (timerMode === 'pomodoro') {
    pausePomodoro();
  }
}

function resetTimer() {
  if (timerMode === 'timer') {
    resetFocusTimer();
  } else if (timerMode === 'stopwatch') {
    resetStopwatch();
  } else if (timerMode === 'pomodoro') {
    resetPomodoro();
  }
}

// Focus Timer Functions
function startFocusTimer() {
  if (currentTimer.running) return;
  
  const hours = parseInt(document.getElementById('hours').value) || 0;
  const minutes = parseInt(document.getElementById('minutes').value) || 0;
  const seconds = parseInt(document.getElementById('seconds').value) || 0;
  
  if (hours === 0 && minutes === 0 && seconds === 0) {
    showNotification('Please set a timer first!');
    return;
  }
  
  currentTimer = {
    hours,
    minutes,
    seconds,
    running: true,
    totalSeconds: hours * 3600 + minutes * 60 + seconds
  };
  
  updateTimerDisplay();
  
  timerInterval = setInterval(() => {
    currentTimer.totalSeconds--;
    
    if (currentTimer.totalSeconds <= 0) {
      completeTimer();
      return;
    }
    
    updateTimerDisplay();
  }, 1000);
  
  updateTimerButtons(true);
  showNotification('Focus timer started! Stay productive! ‚è∞');
}

function completeTimer() {
  clearInterval(timerInterval);
  currentTimer.running = false;
  updateTimerButtons(false);
  
  // Calculate session duration
  const duration = (currentTimer.hours * 3600) + (currentTimer.minutes * 60) + currentTimer.seconds;
  
  // Save session to database
  const session = db.addSession(duration);
  
  // Update UI
  updateUserStats();
  updateCalendar();
  
  showNotification(`üéä Session Complete! +${session.coinsEarned} coins | +${session.xpEarned} XP`);
  triggerConfetti();
  
  // Play completion sound if enabled
  if (db.settings.soundEffects) {
    playCompletionSound();
  }
}

function pauseFocusTimer() {
  if (!currentTimer.running) return;
  
  clearInterval(timerInterval);
  currentTimer.running = false;
  updateTimerButtons(false);
  showNotification('Timer paused');
}

function resetFocusTimer() {
  clearInterval(timerInterval);
  currentTimer.running = false;
  currentTimer.totalSeconds = currentTimer.hours * 3600 + currentTimer.minutes * 60 + currentTimer.seconds;
  updateTimerDisplay();
  updateTimerButtons(false);
  showNotification('Timer reset');
}

function updateTimerDisplay() {
  if (timerMode === 'timer') {
    const hours = Math.floor(currentTimer.totalSeconds / 3600);
    const minutes = Math.floor((currentTimer.totalSeconds % 3600) / 60);
    const seconds = currentTimer.totalSeconds % 60;
    
    document.getElementById('timerDisplay').textContent = 
      `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }
}

// Stopwatch Functions
function startStopwatch() {
  if (stopwatchRunning) return;
  
  stopwatchRunning = true;
  stopwatchInterval = setInterval(() => {
    stopwatchTime++;
    updateStopwatchDisplay();
  }, 1000);
  
  updateTimerButtons(true);
  showNotification('Stopwatch started! ‚è±Ô∏è');
}

function pauseStopwatch() {
  if (!stopwatchRunning) return;
  
  clearInterval(stopwatchInterval);
  stopwatchRunning = false;
  updateTimerButtons(false);
  showNotification('Stopwatch paused');
}

function resetStopwatch() {
  clearInterval(stopwatchInterval);
  stopwatchRunning = false;
  stopwatchTime = 0;
  lapTimes = [];
  updateStopwatchDisplay();
  document.getElementById('lapTimes').innerHTML = '';
  document.getElementById('lapCount').innerHTML = '<i class="fas fa-flag"></i> Laps: 0';
  updateTimerButtons(false);
  showNotification('Stopwatch reset');
}

function recordLap() {
  if (!stopwatchRunning) return;
  
  lapTimes.push({
    time: stopwatchTime,
    display: formatTime(stopwatchTime)
  });
  
  const lapTimesElement = document.getElementById('lapTimes');
  const lapNumber = lapTimes.length;
  
  const lapElement = document.createElement('div');
  lapElement.className = 'label-container';
  lapElement.innerHTML = `
    <span class="label label-primary">
      <i class="fas fa-flag"></i> Lap ${lapNumber}: ${formatTime(stopwatchTime)}
    </span>
  `;
  
  lapTimesElement.prepend(lapElement);
  document.getElementById('lapCount').innerHTML = `<i class="fas fa-flag"></i> Laps: ${lapTimes.length}`;
  
  showNotification(`Lap ${lapNumber} recorded!`);
}

function updateStopwatchDisplay() {
  document.getElementById('stopwatchDisplay').textContent = formatTime(stopwatchTime);
}

function formatTime(seconds) {
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;
  return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

// Pomodoro Functions
function startPomodoro() {
  if (pomodoroState.isRunning) return;
  
  pomodoroState.isRunning = true;
  pomodoroState.focusTime = parseInt(document.getElementById('focusTime').value) * 60;
  pomodoroState.breakTime = parseInt(document.getElementById('breakTime').value) * 60;
  pomodoroState.totalSessions = parseInt(document.getElementById('pomodoroSessions').value);
  
  pomodoroState.currentTime = pomodoroState.isBreak ? pomodoroState.breakTime : pomodoroState.focusTime;
  
  updatePomodoroDisplay();
  
  pomodoroInterval = setInterval(() => {
    pomodoroState.currentTime--;
    
    if (pomodoroState.currentTime <= 0) {
      pomodoroState.isBreak = !pomodoroState.isBreak;
      
      if (!pomodoroState.isBreak) {
        pomodoroState.sessions++;
        if (pomodoroState.sessions >= pomodoroState.totalSessions) {
          completePomodoro();
          return;
        }
      }
      
      pomodoroState.currentTime = pomodoroState.isBreak ? pomodoroState.breakTime : pomodoroState.focusTime;
      
      showNotification(pomodoroState.isBreak ? 'Break time! ‚òï' : 'Focus time! üéØ');
    }
    
    updatePomodoroDisplay();
  }, 1000);
  
  updateTimerButtons(true);
  showNotification(pomodoroState.isBreak ? 'Break started' : 'Pomodoro started! üçÖ');
}

function pausePomodoro() {
  if (!pomodoroState.isRunning) return;
  
  clearInterval(pomodoroInterval);
  pomodoroState.isRunning = false;
  updateTimerButtons(false);
  showNotification('Pomodoro paused');
}

function resetPomodoro() {
  clearInterval(pomodoroInterval);
  pomodoroState = {
    isRunning: false,
    isBreak: false,
    focusTime: 25 * 60,
    breakTime: 5 * 60,
    sessions: 0,
    totalSessions: 4,
    currentTime: 25 * 60
  };
  
  updatePomodoroDisplay();
  updateTimerButtons(false);
  showNotification('Pomodoro reset');
}

function completePomodoro() {
  clearInterval(pomodoroInterval);
  pomodoroState.isRunning = false;
  updateTimerButtons(false);
  
  // Save completed pomodoro sessions
  const totalTime = pomodoroState.sessions * pomodoroState.focusTime;
  const session = db.addSession(totalTime, 'pomodoro');
  
  updateUserStats();
  
  showNotification(`üéâ Pomodoro Complete! ${pomodoroState.sessions} sessions | +${session.coinsEarned} coins`);
  triggerConfetti();
}

function updatePomodoroDisplay() {
  const minutes = Math.floor(pomodoroState.currentTime / 60);
  const seconds = pomodoroState.currentTime % 60;
  document.getElementById('pomodoroDisplay').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  
  document.getElementById('pomodoroPhase').innerHTML = 
    `<i class="fas fa-clock"></i> ${pomodoroState.isBreak ? 'Break Time' : 'Focus Time'} (${pomodoroState.sessions + 1}/${pomodoroState.totalSessions})`;
}

function updateTimerButtons(running) {
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  
  if (running) {
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    resetBtn.disabled = false;
  } else {
    startBtn.disabled = false;
    pauseBtn.disabled = true;
    resetBtn.disabled = false;
  }
}

// ===== HABIT TRACKER =====
function loadHabits() {
  const habitsList = document.getElementById('habitsList');
  if (!habitsList) return;
  
  const habits = db.getHabits();
  
  if (habits.length === 0) {
    habitsList.innerHTML = `
      <div style="text-align: center; padding: 2rem;">
        <div class="label-container">
          <span class="label label-secondary">
            <i class="fas fa-clipboard-list"></i> No habits yet
          </span>
        </div>
        <p style="text-align: center; margin-top: 1rem; color: rgba(255,255,255,0.5);">
          Create your first habit to start tracking!
        </p>
      </div>
    `;
    return;
  }
  
  habitsList.innerHTML = '';
  
  habits.forEach(habit => {
    const habitElement = document.createElement('div');
    habitElement.className = 'market-item';
    habitElement.innerHTML = `
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <div>
          <h4 style="margin-bottom: 0.5rem;">${habit.name}</h4>
          <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">${habit.description || 'No description'}</p>
          <div class="label-container" style="margin-top: 0.5rem;">
            <span class="label label-success">
              <i class="fas fa-fire"></i> ${habit.streak} day streak
            </span>
          </div>
        </div>
        <button class="buy-btn ${habit.completedToday ? 'owned' : ''}" 
                onclick="toggleHabit(${habit.id})"
                style="min-width: 120px;">
          ${habit.completedToday ? '‚úì DONE' : 'MARK DONE'}
        </button>
      </div>
    `;
    
    habitsList.appendChild(habitElement);
  });
}

function toggleHabit(id) {
  const habit = db.updateHabit(id, true);
  
  if (habit && habit.completedToday) {
    showNotification(`Habit completed! +10 coins üéâ`);
    updateUserStats();
    loadHabits();
    triggerConfetti();
  }
}

function addNewHabit() {
  const name = prompt('Enter habit name:');
  if (!name) return;
  
  const description = prompt('Enter habit description (optional):') || '';
  
  db.addHabit(name, description);
  showNotification('New habit added! üìù');
  loadHabits();
}

// ===== TO-DO LIST =====
function loadTodos() {
  const todoList = document.getElementById('todoList');
  if (!todoList) return;
  
  const todos = db.getTodos();
  
  todoList.innerHTML = '';
  
  if (todos.length === 0) {
    todoList.innerHTML = `
      <div style="text-align: center; padding: 2rem;">
        <div class="label-container">
          <span class="label label-secondary">
            <i class="fas fa-tasks"></i> No tasks yet
          </span>
        </div>
        <p style="text-align: center; margin-top: 1rem; color: rgba(255,255,255,0.5);">
          Add your first task to get started!
        </p>
      </div>
    `;
    updateTodoStats();
    return;
  }
  
  todos.forEach(todo => {
    const todoElement = document.createElement('div');
    todoElement.className = `todo-item ${todo.completed ? 'completed' : ''}`;
    todoElement.innerHTML = `
      <div class="todo-checkbox ${todo.completed ? 'checked' : ''}" onclick="toggleTodo(${todo.id})"></div>
      <div class="todo-text">${todo.text}</div>
      <div class="todo-priority priority-${todo.priority}">${todo.priority}</div>
      <button class="buy-btn" onclick="deleteTodo(${todo.id})" style="padding: 0.3rem 0.6rem;">
        <i class="fas fa-trash"></i>
      </button>
    `;
    
    todoList.appendChild(todoElement);
  });
  
  updateTodoStats();
}

function addTodo() {
  const input = document.getElementById('newTodo');
  const priority = document.getElementById('todoPriority').value;
  
  if (!input.value.trim()) {
    showNotification('Please enter a task');
    return;
  }
  
  db.addTodo(input.value, priority);
  input.value = '';
  
  loadTodos();
  showNotification('Task added! ‚úÖ');
}

function toggleTodo(id) {
  db.toggleTodo(id);
  loadTodos();
}

function deleteTodo(id) {
  db.todos = db.todos.filter(t => t.id !== id);
  db.saveData();
  loadTodos();
  showNotification('Task deleted');
}

function updateTodoStats() {
  const todos = db.getTodos();
  const total = todos.length;
  const completed = todos.filter(t => t.completed).length;
  const productivity = total > 0 ? Math.round((completed / total) * 100) : 0;
  
  document.getElementById('totalTasks').textContent = total;
  document.getElementById('completedTasks').textContent = completed;
  document.getElementById('productivityScore').textContent = `${productivity}%`;
}

// ===== NOTES =====
function loadNotes() {
  const notesContainer = document.getElementById('notesContainer');
  if (!notesContainer) return;
  
  const notes = db.getNotes();
  
  notesContainer.innerHTML = '';
  
  if (notes.length === 0) {
    notesContainer.innerHTML = `
      <div style="text-align: center; padding: 2rem; grid-column: 1 / -1;">
        <div class="label-container">
          <span class="label label-secondary">
            <i class="fas fa-sticky-note"></i> No notes yet
          </span>
        </div>
        <p style="text-align: center; margin-top: 1rem; color: rgba(255,255,255,0.5);">
          Create your first note!
        </p>
      </div>
    `;
    return;
  }
  
  notes.slice(-6).reverse().forEach(note => {
    const noteElement = document.createElement('div');
    noteElement.className = 'note-card';
    noteElement.innerHTML = `
      <div class="note-title">${note.title}</div>
      <div class="note-content">${note.content.length > 100 ? note.content.substring(0, 100) + '...' : note.content}</div>
      <div class="note-date">${new Date(note.createdAt).toLocaleDateString()}</div>
    `;
    
    notesContainer.appendChild(noteElement);
  });
}

function saveQuickNote() {
  const content = document.getElementById('quickNote').value;
  
  if (!content.trim()) {
    showNotification('Please enter some content');
    return;
  }
  
  db.addNote('Quick Note', content);
  document.getElementById('quickNote').value = '';
  
  loadNotes();
  showNotification('Note saved! üìù');
}

function clearQuickNote() {
  document.getElementById('quickNote').value = '';
}

// ===== CALENDAR =====
function updateCalendar() {
  const calendarDays = document.getElementById('calendarDays');
  const currentMonth = document.getElementById('currentMonth');
  
  if (!calendarDays) return;
  
  const year = currentDate.getFullYear();
  const month = currentDate.getMonth();
  
  currentMonth.textContent = currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
  
  // Get first day of month
  const firstDay = new Date(year, month, 1);
  const lastDay = new Date(year, month + 1, 0);
  
  // Clear calendar
  calendarDays.innerHTML = '';
  
  // Add day labels
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  days.forEach(day => {
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    dayElement.textContent = day;
    calendarDays.appendChild(dayElement);
  });
  
  // Add empty cells for days before first day
  for (let i = 0; i < firstDay.getDay(); i++) {
    const emptyElement = document.createElement('div');
    emptyElement.className = 'calendar-date';
    calendarDays.appendChild(emptyElement);
  }
  
  // Add days of month
  for (let day = 1; day <= lastDay.getDate(); day++) {
    const dateElement = document.createElement('div');
    dateElement.className = 'calendar-date';
    dateElement.textContent = day;
    
    const dateKey = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
    const hasSession = db.calendarData[dateKey];
    
    if (hasSession) {
      dateElement.classList.add('has-session');
    }
    
    // Check if today
    const today = new Date();
    if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
      dateElement.classList.add('active');
    }
    
    dateElement.onclick = () => showDayDetails(dateKey, day);
    calendarDays.appendChild(dateElement);
  }
}

function prevMonth() {
  currentDate.setMonth(currentDate.getMonth() - 1);
  updateCalendar();
}

function nextMonth() {
  currentDate.setMonth(currentDate.getMonth() + 1);
  updateCalendar();
}

function showDayDetails(dateKey, day) {
  const dayDetails = document.getElementById('dayDetails');
  const selectedDate = document.getElementById('selectedDate');
  const dayStats = document.getElementById('dayStats');
  
  const date = new Date(dateKey);
  selectedDate.textContent = date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  
  const data = db.calendarData[dateKey];
  
  if (data) {
    const hours = Math.floor(data.focusTime / 3600);
    const minutes = Math.floor((data.focusTime % 3600) / 60);
    
    dayStats.innerHTML = `
      <div class="stats-grid" style="margin-top: 1rem;">
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-clock"></i></div>
          <div class="stat-value">${hours}h ${minutes}m</div>
          <div class="stat-label">Focus Time</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon"><i class="fas fa-tasks"></i></div>
          <div class="stat-value">${data.sessions}</div>
          <div class="stat-label">Sessions</div>
        </div>
      </div>
    `;
  } else {
    dayStats.innerHTML = `
      <div style="text-align: center; padding: 2rem;">
        <div class="label-container">
          <span class="label label-secondary">
            <i class="fas fa-calendar-day"></i> No sessions
          </span>
        </div>
        <p style="text-align: center; margin-top: 1rem; color: rgba(255,255,255,0.5);">
          No focus sessions recorded for this day
        </p>
      </div>
    `;
  }
  
  dayDetails.style.display = 'block';
}

// ===== MARKETPLACE =====
function filterMarket(category) {
  const items = category === 'all' 
    ? db.marketItems 
    : db.marketItems.filter(item => item.category === category);
  
  renderMarketplaceItems(items);
  
  // Update active filter button
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
}

function renderMarketplace() {
  renderMarketplaceItems(db.marketItems);
}

function renderMarketplaceItems(items) {
  const grid = document.getElementById('marketplaceGrid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  items.forEach((item, index) => {
    const isOwned = currentUser && currentUser.ownedItems && currentUser.ownedItems.includes(item.id);
    const canAfford = currentUser && currentUser.coins >= item.price;
    
    const itemEl = document.createElement('div');
    itemEl.className = `market-item ${isOwned ? 'owned' : ''} ${item.rarity}`;
    itemEl.style.animationDelay = `${index * 0.1}s`;
    itemEl.innerHTML = `
      ${item.rarity === 'legendary' || item.rarity === 'mythic' ? 
        `<div class="item-badge">${item.rarity === 'mythic' ? 'MYTHIC' : 'LEGENDARY'}</div>` : ''}
      
      <div class="item-icon"><i class="${item.icon}"></i></div>
      <div class="item-name">${item.name}</div>
      <div class="item-desc">${item.description}</div>
      
      <div class="item-stats">
        <span class="rarity ${item.rarity}">${item.rarity.toUpperCase()}</span>
        <span><i class="fas fa-coins"></i> ${item.price}</span>
      </div>
      
      <div class="item-price">
        <div class="price-tag"><i class="fas fa-coins"></i> ${item.price}</div>
        <button class="buy-btn ${isOwned ? 'owned' : ''}" 
                onclick="purchaseItem(${item.id})" 
                ${isOwned || !canAfford ? 'disabled' : ''}>
          ${isOwned ? 'OWNED' : (canAfford ? 'BUY NOW' : `NEED ${item.price - currentUser.coins}`)}
        </button>
      </div>
    `;
    
    grid.appendChild(itemEl);
  });
}

async function purchaseItem(itemId) {
  try {
    const result = await db.purchaseItem(itemId);
    
    currentUser.coins = result.coins;
    
    updateUserStats();
    renderMarketplace();
    
    showNotification('Item purchased successfully! üéÅ');
    triggerConfetti();
  } catch (error) {
    showNotification(error.message);
  }
}

// ===== ACHIEVEMENTS =====
function renderAchievements() {
  const grid = document.getElementById('achievementsGrid');
  if (!grid) return;
  
  grid.innerHTML = '';
  
  db.achievements.forEach((achievement, index) => {
    const isUnlocked = currentUser.achievements.includes(achievement.id);
    
    const achievementEl = document.createElement('div');
    achievementEl.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
    achievementEl.style.animationDelay = `${index * 0.1}s`;
    achievementEl.innerHTML = `
      <div class="achievement-icon">
        <i class="${achievement.icon}"></i>
      </div>
      <h3 style="margin-bottom: 0.5rem; color: ${isUnlocked ? 'var(--primary)' : 'rgba(255,255,255,0.7)'};">${achievement.name}</h3>
      <p style="color: rgba(255,255,255,0.7); margin-bottom: 1rem; font-size: 0.9rem;">${achievement.description}</p>
      
      <div class="achievement-progress">
        <div class="progress-text">
          <span>${isUnlocked ? 'UNLOCKED' : 'LOCKED'}</span>
          <span>${achievement.points} pts</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${isUnlocked ? '100%' : '0%'}"></div>
        </div>
      </div>
      
      ${isUnlocked ? `
        <div class="label-container" style="margin-top: 1rem;">
          <span class="label label-success">
            <i class="fas fa-unlock"></i> Unlocked
          </span>
        </div>
      ` : ''}
    `;
    
    grid.appendChild(achievementEl);
  });
}

// ===== STATISTICS =====
function updateUserStats() {
  if (!currentUser) return;
  
  // Update header
  document.getElementById('coins').textContent = currentUser.coins;
  document.getElementById('lvl').textContent = currentUser.level;
  document.getElementById('headerUsername').textContent = currentUser.username;
  
  // Calculate XP percentage
  const xpNeeded = currentUser.level * 100;
  const xpPercent = Math.min(100, (currentUser.xp / xpNeeded) * 100);
  document.getElementById('xpBadge').textContent = `${Math.round(xpPercent)}%`;
  
  // Update stats section
  const hours = Math.floor(currentUser.totalFocusTime / 3600);
  const minutes = Math.floor((currentUser.totalFocusTime % 3600) / 60);
  
  document.getElementById('totalCoins').textContent = currentUser.coins;
  document.getElementById('currentStreak').textContent = currentUser.streak;
  document.getElementById('totalFocusTime').textContent = `${hours}h`;
  document.getElementById('activeDays').textContent = Object.keys(db.calendarData).length;
  document.getElementById('completedSessions').textContent = db.sessions.length;
  document.getElementById('achievementsCount').textContent = currentUser.achievements.length;
  
  // Update progress bars
  document.getElementById('coinsProgress').style.width = `${Math.min(100, currentUser.coins / 5000 * 100)}%`;
  document.getElementById('streakProgress').style.width = `${Math.min(100, currentUser.streak / 100 * 100)}%`;
  document.getElementById('timeProgress').style.width = `${Math.min(100, currentUser.totalFocusTime / 360000 * 100)}%`;
  document.getElementById('daysProgress').style.width = `${Math.min(100, Object.keys(db.calendarData).length / 365 * 100)}%`;
  document.getElementById('sessionsProgress').style.width = `${Math.min(100, db.sessions.length / 500 * 100)}%`;
  document.getElementById('achievementsProgress').style.width = `${Math.min(100, currentUser.achievements.length / 10 * 100)}%`;
  
  // Update weekly chart
  updateWeeklyChart();
  
  // Update water tracker
  updateWaterTracker();
}

function updateWeeklyChart() {
  const chart = document.getElementById('weeklyChart');
  if (!chart) return;
  
  const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
  const today = new Date();
  const weekData = [];
  
  // Get data for last 7 days
  for (let i = 6; i >= 0; i--) {
    const date = new Date(today);
    date.setDate(date.getDate() - i);
    const dateKey = date.toISOString().split('T')[0];
    const data = db.calendarData[dateKey];
    weekData.push(data ? Math.floor(data.focusTime / 60) : 0);
  }
  
  const maxTime = Math.max(...weekData, 60); // At least 60 minutes for scale
  
  chart.innerHTML = '';
  
  days.forEach((day, index) => {
    const minutes = weekData[index] || 0;
    const percent = Math.min(100, (minutes / maxTime) * 100);
    
    const bar = document.createElement('div');
    bar.className = 'chart-bar';
    bar.style.height = `${percent}%`;
    bar.setAttribute('data-value', `${minutes} min`);
    
    const dayLabel = document.createElement('div');
    dayLabel.textContent = day;
    dayLabel.style.textAlign = 'center';
    dayLabel.style.marginTop = '0.5rem';
    dayLabel.style.color = 'rgba(255,255,255,0.7)';
    dayLabel.style.fontSize = '0.9rem';
    
    chart.appendChild(bar);
    chart.appendChild(dayLabel);
  });
}

function updateWaterTracker() {
  const waterGlasses = document.getElementById('waterGlasses');
  if (!waterGlasses) return;
  
  const today = new Date().toDateString();
  const waterData = JSON.parse(localStorage.getItem('focusArenaWater') || '{}');
  const todayGlasses = waterData[today] || 0;
  
  waterGlasses.innerHTML = '';
  
  for (let i = 0; i < 8; i++) {
    const glass = document.createElement('div');
    glass.className = `water-glass ${i < todayGlasses ? 'filled' : ''}`;
    glass.onclick = () => toggleWaterGlass(i);
    waterGlasses.appendChild(glass);
  }
}

function toggleWaterGlass(index) {
  const today = new Date().toDateString();
  const waterData = JSON.parse(localStorage.getItem('focusArenaWater') || '{}');
  const todayGlasses = waterData[today] || 0;
  
  if (index === todayGlasses - 1) {
    // Remove glass
    waterData[today] = Math.max(0, todayGlasses - 1);
  } else if (index === todayGlasses) {
    // Add glass
    waterData[today] = Math.min(8, todayGlasses + 1);
    
    // Award coins for staying hydrated
    if (waterData[today] === 8) {
      db.user.coins += 20;
      db.saveData();
      updateUserStats();
      showNotification('üéâ Hydration goal reached! +20 coins');
    }
  }
  
  localStorage.setItem('focusArenaWater', JSON.stringify(waterData));
  updateWaterTracker();
}

function resetWaterTracker() {
  const today = new Date().toDateString();
  const waterData = JSON.parse(localStorage.getItem('focusArenaWater') || '{}');
  waterData[today] = 0;
  localStorage.setItem('focusArenaWater', JSON.stringify(waterData));
  updateWaterTracker();
  showNotification('Water tracker reset');
}

function setMood(mood) {
  selectedMood = mood;
  
  // Update UI
  document.querySelectorAll('.mood-option').forEach(opt => {
    opt.classList.remove('selected');
  });
  event.target.closest('.mood-option').classList.add('selected');
  
  // Save mood
  const today = new Date().toDateString();
  const moodData = JSON.parse(localStorage.getItem('focusArenaMoods') || '{}');
  moodData[today] = mood;
  localStorage.setItem('focusArenaMoods', JSON.stringify(moodData));
  
  showNotification(`Mood set: ${mood}`);
}

// ===== FOCUS MUSIC =====
function loadFocusMusic() {
  const musicGrid = document.getElementById('focusMusicGrid');
  if (!musicGrid) return;
  
  const musicTracks = [
    { id: 1, name: "Rain Sounds", icon: "fas fa-cloud-rain", color: "#2196F3" },
    { id: 2, name: "Forest Ambience", icon: "fas fa-tree", color: "#4CAF50" },
    { id: 3, name: "White Noise", icon: "fas fa-volume-up", color: "#9C27B0" },
    { id: 4, name: "Ocean Waves", icon: "fas fa-water", color: "#00BCD4" },
    { id: 5, name: "Coffee Shop", icon: "fas fa-coffee", color: "#795548" },
    { id: 6, name: "Classical", icon: "fas fa-music", color: "#FF9800" }
  ];
  
  musicGrid.innerHTML = '';
  
  musicTracks.forEach(track => {
    const trackElement = document.createElement('div');
    trackElement.className = 'music-track';
    trackElement.innerHTML = `
      <div style="font-size: 2rem; margin-bottom: 0.5rem; color: ${track.color};">
        <i class="${track.icon}"></i>
      </div>
      <div>${track.name}</div>
    `;
    
    trackElement.onclick = () => playFocusMusic(track.id);
    musicGrid.appendChild(trackElement);
  });
}

function playFocusMusic(trackId) {
  // In a real app, this would play actual music
  // For this demo, we'll just show a notification
  
  const tracks = {
    1: "Rain Sounds",
    2: "Forest Ambience",
    3: "White Noise",
    4: "Ocean Waves",
    5: "Coffee Shop",
    6: "Classical Music"
  };
  
  showNotification(`Now playing: ${tracks[trackId]} üéµ`);
  
  // Update UI
  document.querySelectorAll('.music-track').forEach(track => {
    track.classList.remove('playing');
  });
  event.target.closest('.music-track').classList.add('playing');
}

// ===== SETTINGS =====
function loadSettings() {
  // Load current settings
  document.getElementById('soundEffects').checked = db.settings.soundEffects;
  document.getElementById('notifications').checked = db.settings.notifications;
  document.getElementById('focusReminders').checked = db.settings.focusReminders;
  document.getElementById('autoSave').checked = db.settings.autoSave;
  document.getElementById('defaultTimer').value = db.settings.defaultTimer;
  document.getElementById('autoBreak').checked = db.settings.autoBreak;
  document.getElementById('endSound').value = db.settings.endSound;
  
  // Add event listeners
  document.getElementById('soundEffects').onchange = saveSettings;
  document.getElementById('notifications').onchange = saveSettings;
  document.getElementById('focusReminders').onchange = saveSettings;
  document.getElementById('autoSave').onchange = saveSettings;
  document.getElementById('defaultTimer').onchange = saveSettings;
  document.getElementById('autoBreak').onchange = saveSettings;
  document.getElementById('endSound').onchange = saveSettings;
}

function saveSettings() {
  const settings = {
    soundEffects: document.getElementById('soundEffects').checked,
    notifications: document.getElementById('notifications').checked,
    focusReminders: document.getElementById('focusReminders').checked,
    autoSave: document.getElementById('autoSave').checked,
    defaultTimer: parseInt(document.getElementById('defaultTimer').value) || 25,
    autoBreak: document.getElementById('autoBreak').checked,
    endSound: document.getElementById('endSound').value
  };
  
  db.updateSettings(settings);
  showNotification('Settings saved! ‚öôÔ∏è');
}

function changeTheme(theme) {
  // Remove all theme classes
  document.body.classList.remove('theme-dark', 'theme-light', 'theme-ocean', 'theme-forest', 'theme-sunset');
  
  // Add new theme class
  document.body.classList.add(`theme-${theme}`);
  
  // Save to settings
  db.settings.theme = theme;
  db.saveData();
  
  showNotification(`Theme changed to ${theme} üé®`);
}

function exportAllData() {
  const data = db.exportAllData();
  const dataStr = JSON.stringify(data, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
  
  const exportFileDefaultName = `focus-arena-backup-${new Date().toISOString().split('T')[0]}.json`;
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
  
  showNotification('All data exported successfully! üì•');
}

function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  
  input.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    
    reader.onload = (event) => {
      try {
        const data = JSON.parse(event.target.result);
        db.importData(data);
        
        // Reload app
        currentUser = db.user;
        initializeApp();
        
        showNotification('Data imported successfully! üì§');
        triggerConfetti();
      } catch (error) {
        showNotification('Error importing data: ' + error.message);
      }
    };
    
    reader.readAsText(file);
  };
  
  input.click();
}

function resetAppData() {
  if (confirm('Are you sure you want to reset all data? This cannot be undone!')) {
    db.resetData();
    currentUser = db.user;
    initializeApp();
    showNotification('All data reset! üîÑ');
  }
}

// ===== PROFILE MODAL =====
function showProfileModal() {
  const modal = document.getElementById('profileModal');
  const avatarSelection = document.getElementById('modalAvatarSelection');
  const modalAvatar = document.getElementById('modalAvatar');
  const modalUsername = document.getElementById('modalUsername');
  const modalLevel = document.getElementById('modalLevel');
  const editUsername = document.getElementById('editUsername');
  
  // Set current values
  modalAvatar.textContent = currentUser.avatar;
  modalUsername.textContent = currentUser.username;
  modalLevel.textContent = `Level ${currentUser.level} ‚Ä¢ ${currentUser.xp} XP`;
  editUsername.value = currentUser.username;
  
  // Populate avatar selection
  avatarSelection.innerHTML = '';
  avatars.slice(0, 12).forEach(avatar => {
    const avatarOption = document.createElement('div');
    avatarOption.className = 'avatar-option';
    if (avatar === currentUser.avatar) avatarOption.classList.add('selected');
    avatarOption.textContent = avatar;
    avatarOption.onclick = () => {
      document.querySelectorAll('#modalAvatarSelection .avatar-option').forEach(opt => opt.classList.remove('selected'));
      avatarOption.classList.add('selected');
      modalAvatar.textContent = avatar;
    };
    avatarSelection.appendChild(avatarOption);
  });
  
  modal.style.display = 'flex';
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

function updateProfile() {
  const newUsername = document.getElementById('editUsername').value.trim();
  const newAvatar = document.querySelector('#modalAvatarSelection .avatar-option.selected').textContent;
  
  if (!newUsername) {
    showNotification('Please enter a name');
    return;
  }
  
  db.updateUser({
    username: newUsername,
    avatar: newAvatar
  });
  
  currentUser = db.user;
  updateUserStats();
  
  closeModal('profileModal');
  showNotification('Profile updated! ‚úÖ');
}

// ===== ORB FUNCTIONS =====
function createOrbParticles() {
  const orb = document.querySelector('.orb');
  if (!orb) return;
  
  const particlesContainer = document.createElement('div');
  particlesContainer.className = 'orb-particles';
  orb.appendChild(particlesContainer);
  
  // Create particles
  for (let i = 0; i < 15; i++) {
    const particle = document.createElement('div');
    particle.className = 'orb-particle';
    
    // Random position
    const angle = Math.random() * Math.PI * 2;
    const distance = 100 + Math.random() * 80;
    const tx = Math.cos(angle) * distance;
    const ty = Math.sin(angle) * distance;
    
    particle.style.left = '50%';
    particle.style.top = '50%';
    particle.style.setProperty('--tx', `${tx}px`);
    particle.style.setProperty('--ty', `${ty}px`);
    
    // Random color
    const colors = ['#00D4FF', '#9D4EDD', '#FF6B6B', '#4CAF50', '#FF9800'];
    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
    
    // Random delay
    particle.style.animationDelay = `${Math.random() * 2}s`;
    
    particlesContainer.appendChild(particle);
  }
}

function toggleOrbPulse() {
  orbPulse = !orbPulse;
  const orb = document.querySelector('.orb');
  
  if (orbPulse) {
    orb.style.animationPlayState = 'running';
    showNotification('Orb pulse enabled! ‚ú®');
  } else {
    orb.style.animationPlayState = 'paused';
    showNotification('Orb pulse paused');
  }
}

// ===== NAVIGATION =====
let currentSection = 'play';
let navTransitionInProgress = false;

function showSection(sectionId, instant = false) {
  if (navTransitionInProgress || currentSection === sectionId) return;
  
  navTransitionInProgress = true;
  const oldSection = document.getElementById(currentSection);
  const newSection = document.getElementById(sectionId);
  const navButtons = document.querySelectorAll('.nav-btn');
  
  // Update navigation buttons
  navButtons.forEach(btn => {
    btn.classList.remove('active');
    if (btn.getAttribute('data-section') === sectionId) {
      btn.classList.add('active');
    }
  });
  
  if (instant) {
    if (oldSection) oldSection.classList.remove('active');
    if (newSection) newSection.classList.add('active');
    currentSection = sectionId;
    navTransitionInProgress = false;
    
    // Load content for the new section
    loadSectionContent(sectionId);
    return;
  }
  
  // Animate section transition
  if (oldSection && newSection) {
    oldSection.classList.remove('active');
    oldSection.classList.add('section-exit');
    
    setTimeout(() => {
      oldSection.classList.remove('section-exit');
      newSection.classList.add('active');
      currentSection = sectionId;
      navTransitionInProgress = false;
      
      // Load content for the new section
      loadSectionContent(sectionId);
    }, 300);
  }
}

function loadSectionContent(sectionId) {
  switch(sectionId) {
    case 'play':
      updateTimerDisplay();
      loadHabits();
      loadFocusMusic();
      break;
    case 'calendar':
      updateCalendar();
      break;
    case 'todo':
      loadTodos();
      break;
    case 'notes':
      loadNotes();
      break;
    case 'marketplace':
      renderMarketplace();
      break;
    case 'stats':
      updateUserStats();
      break;
    case 'achievements':
      renderAchievements();
      break;
    case 'settings':
      loadSettings();
      break;
  }
}

// ===== UTILITY FUNCTIONS =====
function showNotification(message) {
  const notification = document.getElementById('notification');
  const text = document.getElementById('notificationText');
  
  text.textContent = message;
  notification.classList.add('show');
  
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

function triggerConfetti() {
  for (let i = 0; i < 50; i++) {
    const confetti = document.createElement('div');
    const color = `hsl(${Math.random() * 360}, 100%, 60%)`;
    const size = Math.random() * 10 + 5;
    
    confetti.style.position = 'fixed';
    confetti.style.width = `${size}px`;
    confetti.style.height = `${size}px`;
    confetti.style.background = color;
    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
    confetti.style.left = `${Math.random() * 100}vw`;
    confetti.style.top = '-20px';
    confetti.style.zIndex = '2000';
    confetti.style.pointerEvents = 'none';
    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
    document.body.appendChild(confetti);
    
    confetti.animate([
      { 
        transform: `translate(0, 0) rotate(0deg)`, 
        opacity: 1 
      },
      { 
        transform: `translate(${Math.random() * 200 - 100}px, 100vh) rotate(${Math.random() * 720}deg)`, 
        opacity: 0 
      }
    ], {
      duration: 2000 + Math.random() * 1000,
      easing: 'cubic-bezier(0.215, 0.61, 0.355, 1)'
    });
    
    setTimeout(() => confetti.remove(), 3000);
  }
}

function playCompletionSound() {
  // Create a simple completion sound
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
  oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
  oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
  
  gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
  
  oscillator.start(audioContext.currentTime);
  oscillator.stop(audioContext.currentTime + 0.5);
}

// ===== OFFLINE DETECTION =====
function updateOnlineStatus() {
  if (!navigator.onLine) {
    showNotification('You are offline. All data is saved locally.');
  }
}

// ===== INITIALIZATION =====
window.addEventListener('DOMContentLoaded', () => {
  // Check if user exists
  if (db.user) {
    currentUser = db.user;
    document.getElementById('profileSetup').style.display = 'none';
    document.getElementById('appContainer').classList.add('active');
    initializeApp();
  } else {
    initProfileSetup();
  }
  
  // Set up offline detection
  window.addEventListener('online', updateOnlineStatus);
  window.addEventListener('offline', updateOnlineStatus);
  updateOnlineStatus();
  
  // Auto-save every 30 seconds
  setInterval(() => {
    if (currentUser && db.settings.autoSave) {
      db.saveData();
    }
  }, 30000);
  
  // Motivational quotes
  const quotes = [
    "Your future is created by what you do today! üöÄ",
    "Every minute of focus brings you closer to your goals! ‚è∞",
    "Great things never come from comfort zones! üí™",
    "The secret of getting ahead is getting started! ‚ú®",
    "Don't watch the clock; do what it does. Keep going! üîÑ",
    "Productivity is never an accident. It's always the result of commitment to excellence! üåü",
    "The way to get started is to quit talking and begin doing! üèÉ‚Äç‚ôÇÔ∏è",
    "Focus on being productive instead of busy! üéØ",
    "Your only limit is the focus you bring to your work! ‚ö°",
    "Small daily improvements are the key to staggering long-term results! üìà"
  ];
  
  setInterval(() => {
    if (currentUser && Math.random() > 0.7) {
      const quote = quotes[Math.floor(Math.random() * quotes.length)];
      showNotification(quote);
    }
  }, 600000);
  
  // Close modals when clicking outside
  document.querySelectorAll('.modal').forEach(modal => {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  });
  
  // Close modals with Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = 'none';
      });
    }
  });
});
</script>
</body>
</html>
